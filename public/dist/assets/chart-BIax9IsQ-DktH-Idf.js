const zt=(v,t,s,i)=>({linear:(a,e,h,n)=>h*a/n+e,easeInOutQuad:(a,e,h,n)=>(a/=n*.5,a<1?h*.5*a*a+e:(a--,-h/2*(a*(a-2)-1)+e))})[i](s,v,t-v,1);class Yt{constructor(t){this.queue={},this.queueSize=0,this.step=()=>{const s=[],i=+new Date;let a,e,h,n,l;const d={top:!1,bottom:!1};for(const o in this.queue){a=this.queue[o],e=i,h=a.endDt-a.startDt,l=a.state[o];const m=e<a.startDt;e<a.startDt?e=a.startDt:e>a.endDt&&(e=a.endDt),n=h?(e-a.startDt)/h:m?0:1;let r;n<1?a.tween==="exp"?r=l+(a.end-l)*a.speed:r=zt(a.start,a.end,n,a.tween):r=a.end,r!==l?(a.state[o]=r,d.top=d.top||a.group.top,d.bottom=d.bottom||a.group.bottom):r===a.end&&s.push(o)}let p=0;for(;p<s.length;)this.queue[s[p]].cbEnd&&this.queue[s[p]].cbEnd(this.queue[s[p]].state),delete this.queue[s[p]],p++;this.queueSize-=s.length,this.composer.render(d),this.queueSize?this.animFrame=requestAnimationFrame(this.step):delete this.animFrame},this.composer=t.composer,this.state=t.state}add(t){let s=0;const i=+new Date;let a,e,h;const n=this.queue;for(;s<t.length;){if(e=t[s],a=n[e.prop],!a){if(e.end===e.state[e.prop]){e.cbEnd&&e.cbEnd(e.state),s++;continue}a={lastStart:1},n[e.prop]=a,this.queueSize++}h=i-a.lastStart,e.duration*=this.state.speed,e.delay*=this.state.speed,a.cbEnd=e.cbEnd,a.state=e.state,a.lastStart=i,a.start=e.state[e.prop],a.end=e.end,a.startDt=i+(e.delay||0),a.endDt=a.startDt+(e.duration||0)-(e.fixed?0:Math.max(e.duration-h,0)),a.tween=e.tween||"easeInOutQuad",a.speed=e.speed,a.group=e.group,s++}this.animFrame||(this.animFrame=requestAnimationFrame(this.step))}get(t){return this.queue[t]}}const kt=["January","February","March","April","May","June","July","August","September","October","November","December"],Nt=kt.map(v=>v.slice(0,3)),Ct=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],Ht=Ct.map(v=>v.slice(0,3));function Ot(v,t){return Ft(v,t)}let Tt;function Ft(v,t){return Tt===void 0&&(Tt=new Date().getTimezoneOffset()*6e4),t.getLabelTime(864e5+ +v*36e5+Tt)}function Et(v,t){return t.getLabelDate(v,{isShort:!0,displayYear:!1})}function Pt(v,t){return t.getLabelTime(v)}function Xt(v,{isShort:t,isMonthShort:s=!0,displayWeekDay:i,displayYear:a=!0,displayHours:e}={}){const h=new Date(v),n=t?Ht:Ct;let l=`${h.getUTCDate()} ${(s?Nt:kt)[h.getUTCMonth()]}`;return i&&(l=`${n[h.getUTCDay()]}, `+l),a&&(l+=` ${h.getUTCFullYear()}`),e&&(l+=`, ${("0"+h.getUTCHours()).slice(-2)}:${("0"+h.getUTCMinutes()).slice(-2)}`),l}function Gt(v){return new Date(v).toString().match(/(\d+:\d+):/)[1]}Math.log2||(Math.log2=function(v){return Math.log(v)*Math.LOG2E});Math.log10||(Math.log10=function(v){return Math.log(v)*Math.LOG10E});function Wt(v,t,s,i,a,e,h,n,l){const d=(n-h)/l,p=[],o=[];if(d<=1)return{xInd1:h,xInd2:n,x:t,ys:s};{let m=0,r=-999999999;const c=e.length;let u;for(let M=h;M<=n;M++){const w=t[M]*i+a<<0,y=w>r;y?(p[m]=t[M],m++):u++;for(let g=0;g<c;g++){const f=e[g];o[f]=o[f]||{y:[]};const T=o[f].y[m-1],R=s[f].y[M];T===void 0?o[f].y[m-1]=R:o[f].y[m-1]+=R,m>1&&(y&&(o[f].y[m-2]/=u),M===n&&(o[f].y[m-1]/=u))}y&&(u=1),r=w}return h=0,n=m-1,{isOptimized:d>1,xInd1:0,xInd2:m-1,x:p,ys:o}}}function ut(v){const t=v.getBoundingClientRect();return{x:t.left+(window.pageXOffset||document.documentElement.scrollLeft),y:t.top+(window.pageYOffset||document.documentElement.scrollTop)}}function J(v,t,s){let i=0,a=v.length-1;for(s||(t<v[i]?t=v[i]:t>v[a]&&(t=v[a]));Math.abs(i-a)>1;){const e=Math.round((i+a)/2);t>=v[i]&&t<=v[e]?a=e:i=e}return i+(t-v[i])/(v[a]-v[i])}function St(v,t){typeof window.CustomEvent=="function"&&document.dispatchEvent(new CustomEvent(v,{detail:t||null}))}function bt(){const v=" -webkit- -moz- -o- -ms- ".split(" "),t=i=>window.matchMedia(i).matches;if("ontouchstart"in window||window.DocumentTouch&&document instanceof DocumentTouch)return!0;const s=["(",v.join("touch-enabled),("),"heartz",")"].join("");return t(s)}function ft(v,t,s,i,a,e,h){s*=t,i*=t,a*=t,e*=t,typeof h=="number"&&(h=[h,h,h,h]),h[0]*=t,h[1]*=t,h[2]*=t,h[3]*=t,v.beginPath(),v.moveTo(a+h[0],e),v.lineTo(a+s-h[1],e),v.quadraticCurveTo(a+s,e,a+s,e+h[1]),v.lineTo(a+s,e+i-h[2]),v.quadraticCurveTo(a+s,e+i,a+s-h[2],e+i),v.lineTo(a+h[3],e+i),v.quadraticCurveTo(a,e+i,a,e+i-h[3]),v.lineTo(a,e+h[0]),v.quadraticCurveTo(a,e,a+h[0],e),v.closePath()}function Bt(v,t,s,i,a,e,h){s*=t,i*=t,a*=t,e*=t,h*=t,s<2*h&&(h=s/2),i<2*h&&(h=i/2),v.beginPath(),v.moveTo(a+h,e),v.arcTo(a+s,e,a+s,e+i,h),v.arcTo(a+s,e+i,a,e+i,h),v.arcTo(a,e+i,a,e,h),v.arcTo(a,e,a+s,e,h),v.closePath()}function dt(v,t,s){const i=(s&&s>.5&&t.details?t.details:t)[v],a={statsFormatDayHourFull:h=>Ft(h,t),statsFormatDayHour:h=>Ot(h,t),"statsFormat('week')":h=>Et(h,t),"statsFormat('day')":h=>Et(h,t),"statsFormat('hour')":h=>Pt(h,t),"statsFormat('5min')":h=>Pt(h,t),statsFormatTooltipValue:Ut,"statsTooltipFormat('week')":h=>t.getLabelDate(h),"statsTooltipFormat('day')":h=>t.getLabelDate(h),"statsTooltipFormat('hour')":h=>t.getLabelTime(h),"statsTooltipFormat('5min')":h=>t.getLabelTime(h),null:h=>""+h};let e=a[i]||a.null;return i==="null"&&(e={xRangeFormatter:h=>t.getLabelDate(h,{isShort:!1,isMonthShort:!1}),yTickFormatter:Vt}[v]||e),e}function Vt(v,t,s){return v===0?"0":t<1e3?""+Math.floor(v):t>=1e3&&t<1e6?s?Math.floor(10*v/1e3)/10+"K":Math.round(v/1e3)+"K":s?Math.floor(10*v/1e6)/10+"M":Math.round(v/1e6)+"M"}function Ut(v){return typeof v!="number"?typeof v=="string"?v:"?":Zt(v)}function Zt(v,t,s){if(v===0)return"0";t===void 0&&(t=Jt(v));const i=qt(v,t);return s===void 0&&(s=jt(i)),i.toFixed(s)+t}function qt(v,t){switch(t){case"K":return v/1e3;case"M":return v/1e6;case"B":return v/1e9;case"T":return v/1e12}return v}function jt(v){var t=Math.abs(v);return t>10?0:t>=1?Math.abs(t-Math.floor(t))<.001?0:1:2}function Jt(v){var t=Math.abs(v);return t>=1e12?"T":t>=1e9?"B":t>=1e6?"M":t>=2e3?"K":""}function Kt(v,t,s,i){Math.abs(t-v)<1&&(v-=v/10,t+=t/10);const a=m=>{const r=n*m,c=Math.floor(v/r)*r,u=c+s*Math.ceil((t-c)*e/r)*r;return{good:u<=d&&c>=l,yMin:Math.round(c),yMax:Math.round(u),yMinOrig:v,yMaxOrig:t}},e=1/s,h=(t-v)*e;let n=Math.max(Math.pow(10,Math.floor(Math.log10(h))),1);const l=v-h*.5,d=t+h*.5;let p,o=1;for(;p=a(5),!(p.good||(p=a(2),p.good)||(p=a(1),p.good));)if(n*=.1,o++,o>10)return{yMinOrig:v,yMaxOrig:t,yMin:v,yMax:t};return p}class Qt{constructor(t){this.opts=t,t.additional.mini&&(this.$canvas=document.createElement("canvas"),this.ctx=this.$canvas.getContext("2d",{alpha:!0}))}onResize(){if(this.opts.additional.mini){var t=this.opts.settings.dpi,s=this.opts.additional.mini?this.opts.state.dims.mini:this.opts.state.dims.graph;this.$canvas.width=s.w*t,this.$canvas.height=s.h*t,this.cached=""}}setDarkMode(t){this.isDarkMode=t}render(){let t,s,i,a,e;const h=this.opts,n=h.data.ys,l=h.state,d=h.additional.mini,p=d?l.xg1:l.x1,o=d?l.xg2:l.x2,m=h.settings,r=m[`PADD${d?"_MINI_AREA":""}`][0],c=m[`PADD${d?"_MINI_AREA":""}`][1],u=m[`PADD${d?"_MINI_AREA":""}`][2],M=m[`PADD${d?"_MINI_AREA":""}`][3],w=h.data.x,y=h.settings.dpi,g=d?this.ctx:this.opts.ctx,f=[],T=[],R=0,$=d?l.dims.mini:l.dims.graph,D=l.zoomMorph===void 0?0:l.zoomMorph;let S=D;l.zoomMode;const L=n.length;if(d){const et=[$.w,$.h,l.xg1,l.xg2,this.isDarkMode,l.zoomMode,D];for(t=0;t<L;t++)et.push(l[`om_${t}`]),et.push(l[`f_${t}`]);const Z=et.join(",");if(Z===this.cached){this.opts.ctx.drawImage(this.$canvas,$.l*y,$.t*y);return}this.cached=Z}e=($.w-c-M)/(o-p);let _=Math.floor(J(w,p-M/e)),b=Math.ceil(J(w,o+c/e));e*=y;const I=(M+(d?0:$.l))*y-p*e,x=($.h-u+(d?0:$.t))*y,A=[],Y=[];let q=0,st=0,tt=0,X=!1;for(t=0;t<L;t++)a=d?l[`om_${t}`]:l[`o_${t}`],X=X||l[`f_${t}`]<1,a<1&&a>0&&(q=a),a>0&&(A.push(t),Y.push(a),a===1&&l[`e_${t}`]&&(st++,tt=A.length-1));const N=A.length;q=st===1?q:1,d?l.y1m:l.y1,d?l.y2m:l.y2;const it=Wt("line",w,n,e,I,A,_,b,$.w-c-M);_=it.xInd1,b=it.xInd2;const k=it.x,U=it.ys;let H=!1;for(s=_;s<=b;s++){for(f[s]=0,T[s]=0,t=0;t<N;t++)T[s]+=(U[A[t]].y[s]||0)*Y[t];T[s]===0&&(H=!0)}(H||X)&&(g.fillStyle=this.opts.settings.COLORS.background,g.fillRect(0,0,$.w*y,$.h*y));let E,F,C,O;if(D>0&&!d){S===1&&(this.savedX1=p,this.savedX2=o);let et,Z;if(S<1){const P=this.opts.animator.get("x1"),z=this.opts.animator.get("x2"),K=P?P.end:this.opts.state.x1,Q=z?z.end:this.opts.state.x2;et=J(w,this.opts.state.zoomDir===-1?this.savedX1:K,!0),Z=J(w,this.opts.state.zoomDir===-1?this.savedX2:Q,!0)}else et=J(w,p,!0),Z=J(w,o,!0);Z--;var G=Math.floor(et),rt=Math.ceil(et),pt=Math.floor(Z),yt=Math.ceil(Z),ot=0,xt=[];for(t=0;t<N;t++){xt[t]=0;const P=n[A[t]].y;let z;for(s=rt;s<=pt;s++)z=(P[s]||0)*Y[t],xt[t]+=z,ot+=z;z=(rt-et)*(P[G]||0)*Y[t],xt[t]+=z,ot+=z,z=(Z-pt)*(P[yt]||0)*Y[t],xt[t]+=z,ot+=z}const j=this.opts.state.zoomDir===1?Math.pow(Math.min(Math.max(S<.85?(S-.65)/.2:1-(S-.9)/.15,0),1),.8):this.prevElastic;let W=2*Math.PI-Math.PI/(7-S)-Math.PI/8*j;const at=W;this.opts.state.zoomDir===1?(S=Math.min(Math.max((S-.25)/.4,0),1),this.prevElastic=j):S=Math.min(Math.max(S*2.4-1.4,0),1),E=[],F=m.PIE_RADIUS*(D<1?2.31:1)*y,C=y*($.w/2+$.l),O=y*($.h/2+$.t+2);const ht=2*Math.PI*F/y,V=1/13;for(t=0;t<N;t++){let P=xt[t]/ot;P=P||0;const z=2*Math.PI*P;let K=W-z;const Q=Math.round(P*ht*V);t===N-1&&(K=at-2*Math.PI);const nt=Math.PI*2*.1/ht,lt=n[A[t]];E.push({st:W+nt,ed:K-nt,mid:W-z/2-nt/2,additionalPoints:Math.max(Q,4),percentage:P===0?0:Math.max(Math.round(P*100),1),percentageText:P===0?"":P<.01?"<1%":Math.round(P*100)+"%",ind:A[t],value:xt[t],label:lt.label,color:this.isDarkMode?lt.colors_n[2]:lt.colors_d[2]}),W=K}l.pieAngles=E}const gt=y*($.h-r-u+(d?0:-4)),Mt=($.h-u+(d?0:$.t))*y;let B=0;for(t=0;t<L;t++){if(a=d?l[`om_${t}`]:l[`o_${t}`],a<=0)continue;i=U[t].y;const et=a*gt;if(g.fillStyle=this.isDarkMode?n[t].colors_n[0]:n[t].colors_d[0],g.globalAlpha=l[`f_${t}`]*.9+.1,g.beginPath(),D===0||!d)if(D===0){if(t>0)for(g.moveTo(k[b]*e+I<<0,x-f[b]+R<<0),s=b-1;s>=_;s--)g.lineTo(k[s]*e+I<<0,x-f[s]+R<<0);else g.moveTo(k[b]*e+I<<0,x<<0),g.lineTo(k[_]*e+I<<0,x<<0);if(B<N-1||H)for(s=_;s<=b;s++){const Z=Mt-(i[s]*et/T[s]||0),j=x-Z;let W=f[s]+j;W>gt&&(W=gt),g.lineTo(k[s]*e+I<<0,x-W<<0),f[s]+=j}else g.lineTo(k[_]*e+I<<0,x-gt<<0),g.lineTo(k[b]*e+I<<0,x-gt<<0)}else{const Z=(z,K,Q,nt)=>{let lt=0,vt=0;ct&&st>1&&(lt=Math.cos(E[B].mid)*ct*8*y,vt=-Math.sin(E[B].mid)*ct*8*y),nt>F&&(nt=F);let mt=Math.atan2(O-K,z-C);mt=mt<0?Math.PI*2+mt:mt;const _t=Math.pow((O-K)*(O-K)+(z-C)*(z-C),.5);Math.abs(Q-mt)>Math.PI*(N===1?1.5:1)&&(Q-=Math.PI*2),Q<-Math.PI*2&&(Q-=-Math.PI*2);const $t=mt+S*(Q-mt),At=_t+S*(nt-_t);return[C+Math.cos($t)*At+lt,O-Math.sin($t)*At+vt]},j=D<1?4:E[B].additionalPoints;let W,at=!1,ht=!1,V;var ct=l[`pieInd_${A[B]}`]||0;E[B].percentage===0&&(g.globalAlpha=0);let P=Z(k[b]*e+I,x-f[b],E[0].st,F);if(g.moveTo(P[0],P[1]),B>0)for(s=b-1;s>=_;s--){if(V=k[s]*e+I,V===C&&(at=!0),V>=C)W=(V-C)/($.w*y/2),S===0&&(W=0),P=Z(V,x-f[s]+R,E[0].st,F*W);else{if(!at){at=!0;const z=(C-V)/(k[s+1]*e+I-V),K=x-f[s]+R,Q=x-f[s+1]+R;P=Z(C,K+z*(Q-K),E[B].st,0),g.lineTo(P[0],P[1])}W=(C-V)/($.w*y/2),P=Z(V,x-f[s]+R,E[B].st,F*W)}g.lineTo(P[0],P[1])}else P=Z(k[_]*e+I,x,E[0].st,F),g.lineTo(P[0],P[1]);if(B<N-1){let z;for(s=0;s<=j;s++){const K=Mt-(i[_]*et/T[_]||0),Q=x-K;z=x-f[_]+R;const nt=x-f[_]-Q;P=Z(k[_]*e+I,z+s/j*(nt-z),E[B].st+s/j*(E[B].ed-E[B].st),F),g.lineTo(P[0],P[1])}for(s=_;s<=b;s++){const K=Mt-(i[s]*et/T[s]||0),Q=x-K;if(V=k[s]*e+I,V===C&&(ht=!0),V<=C){W=(C-V)/($.w*y/2);var Lt=V,It=x-f[s]-Q;P=Z(V,It,E[B].ed,F*W)}else{if(!ht){ht=!0;const nt=(C-Lt)/(V-Lt);z=It;const lt=x-f[s]-Q;P=Z(C,z+nt*(lt-z),E[B].ed,0),g.lineTo(P[0],P[1])}W=(V-C)/($.w*y/2),S===0&&(W=0),P=Z(V,x-f[s]-Q,E[0].st,F*W)}g.lineTo(P[0],P[1]),f[s]+=Q}V<C&&(ht||(P=Z(C,z,E[B].ed,0),g.lineTo(P[0],P[1])))}else for(s=0;s<=j;s++)P=Z((k[_]+s/j*(k[b]-k[_]))*e+I,0,E[B].st+s/j*(E[0].st-2*Math.PI-E[B].st),F),g.lineTo(P[0],P[1])}else{const Z=this.opts.data.mainPeriodLen*e;if(g.moveTo(k[b]*e+Z+I,x-f[b]),t>0)for(g.lineTo(k[b]*e+I,x-f[b]),s=b;s>=_+1;s--)g.lineTo(k[s]*e+I,x-(f[s]+S*(f[s-1]-f[s]))+R),g.lineTo(k[s-1]*e+I,x-f[s-1]+R);else g.lineTo(k[_]*e+I,x);let j;if(B<N-1)for(s=_;s<=b-1;s++){let W=Mt-(i[s]*et/T[s]||0);const at=x-W;s===_&&g.lineTo(k[_]*e+I,x-f[_]-at),W=Mt-(i[s+1]*et/T[s+1]||0),j=x-W;const ht=f[s]+at,V=f[s+1]+j;g.lineTo(k[s+1]*e+I,x-(V+S*(ht-V))),g.lineTo(k[s+1]*e+I,x-V),s===b-1&&g.lineTo(k[b]*e+Z+I,x-f[b]-j),f[s]+=at}else g.lineTo(k[_]*e+I<<0,x-gt<<0),g.lineTo(k[b]*e+I<<0,x-gt<<0);f[b]+=j}if(g.closePath(),g.fill(),!d&&D>0&&E[B].percentageText){const Z=Math.pow(S,this.opts.state.zoomDir===1?4:20)*a*(l[`f_${t}`]*.9+.1);let j=Math.max(Math.min(E[B].percentage*2,26),10);const W=m.PIE_RADIUS;let at=W*2/3;const ht=Math.cos(E[B].mid),V=Math.sin(E[B].mid),P=E[B].percentage<h.data.pieLabelsPercentages.outboard;let z=0,K=0;if(ct&&st>1&&(z=ht*ct*8*y,K=-V*ct*8*y),g.fillStyle="white",g.textAlign="center",g.globalAlpha=Z,E[B].percentage<h.data.pieLabelsPercentages.hoverOnly&&(g.globalAlpha=ct*Z),P){j=Math.max(j,14),at=W+j/3+13,g.fillStyle=this.isDarkMode?n[t].colors_n[0]:n[t].colors_d[0],g.lineWidth=1,g.strokeStyle=this.isDarkMode?n[t].colors_n[0]:n[t].colors_d[0];const vt=C+z+ht*(W-1)*y,mt=O+K-V*(W-1)*y,_t=C+z+ht*(W+6*(1-ct)-1)*y,$t=O+K-V*(W+6*(1-ct)-1)*y;g.beginPath(),g.moveTo(vt,mt),g.lineTo(_t,$t),g.stroke()}const Q=ht*at*(tt===B?q:1),nt=C+z+Q*y+(P?j/4*E[B].percentageText.length*Q/at*y:0),lt=O+K-V*at*(tt===B?q:1)*y;g.font=`${h.settings.FONT.bold} ${j*y}px ${h.settings.FONT.family}`,g.fillText(E[B].percentageText,nt,lt+j*y/2.9),g.globalAlpha=1}B++}g.globalAlpha=1,d&&this.opts.ctx.drawImage(this.$canvas,$.l*y,$.t*y)}}class ts{constructor(t){this.deleteItem=s=>{delete this.items[s.ind]},this.opts=t,this.ctx=t.ctx,this.items={},this.setAnimation(!1)}onResize(){this.setAnimation(!1)}setDarkMode(t){this.isDarkMode=t}setAnimation(t){this.noAnimation=!t}hideItem(t,s){this.items[t].tp=2,this.opts.animator.add([{prop:`ox_${t}`,state:this.items[t].state,end:0,duration:this.noAnimation?0:200*s,tween:"linear",group:{top:!0},cbEnd:this.deleteItem}])}render(t){const s=this.opts,i=s.settings.dpi,a=s.data.x,e=s.state,h=s.settings.PADD[1],n=s.settings.PADD[3],l=s.animator;a.length;const d=this.opts.state.dims.axisX,p=this.opts.state.dims.dates,o=e.zoomMode,m=e.zoomMorph===void 0?0:e.zoomMorph,r=Math.floor(J(a,e.x1)),c=Math.ceil(J(a,e.x2));let u=r,M=c;const w=s.graphStyle==="bar"||s.graphStyle==="step",y=(e.zoomMode&&s.data.details?s.data.details.maxXTickLength:s.data.maxXTickLength)*9,g=w?this.opts.data.mainPeriodLen:0,f=w?this.opts.data.detailPeriodLen:0,T=g+(f-g)*m,R=g*(1-m),$=(d.w-h-n)/Math.round((e.x2-e.x1+g)/this.opts.data.mainPeriodLen),D=(d.w-h-n)/Math.round((e.x2-e.x1+f)/this.opts.data.detailPeriodLen),S=$+(D-$)*m;let L=Math.pow(2,Math.ceil(Math.log2(y/$))),_=Math.pow(2,Math.ceil(Math.log2(y/D)));const b=(d.w-n-h)/(e.x2-e.x1+R);L<1&&(L=1),_<1&&(_=1),this.ctx.font=`${this.opts.settings.FONT.normal} ${11*i}px ${this.opts.settings.FONT.family}`,this.ctx.textAlign="center",this.ctx.fillStyle=this.opts.settings.COLORS.axis.x;const I=this.prevXStep?this.prevXStep>$?this.prevXStep/$:$/this.prevXStep:1;let x=1/Math.pow(I,5);o&&m===1&&(x/=2),this.prevXStep=$;const A=Math.max(r-Math.ceil((n+y*.5)/S),0),Y=Math.min(c+Math.ceil((h+y*.5)/S),a.length-1);if(o){const X=this.opts.animator.get("x1"),N=this.opts.animator.get("x2");u=X?X.end:this.opts.state.x1,M=N?N.end:this.opts.state.x2,u=Math.floor(J(a,u)),M=Math.floor(J(a,M))}let q;if(o){const X=Math.max(a[this.opts.state.detailInd1],this.opts.state.xMainMin),N=Math.min(a[this.opts.state.detailInd2],this.opts.state.xMainMax);q=Math.round((N-X)/this.opts.data.mainPeriodLen)+(w?0:1)}for(let X=A;X<=Y;X++){let N=X%L===0,it="m";o&&(X<this.opts.state.detailInd1?N=X%L===0&&m<1:X<=this.opts.state.detailInd2?(N=Math.max(X-this.opts.state.detailInd1,0)%_===0,it="d"):N=Math.max(X-(this.opts.state.detailInd2-this.opts.state.detailInd1+1-q),0)%L===0&&m<1);const k=a[X]+it;let U=this.items[k];if(N?U?U.tp===2&&(U.tp=1,l.add([{prop:`ox_${k}`,state:U.state,end:1,duration:this.noAnimation?0:200*x,tween:"linear",group:{top:!0}}])):(U={tp:1,xi:a[X],i:X,state:{ind:k}},U.state[`ox_${k}`]=0,this.items[k]=U,l.add([{prop:`ox_${k}`,state:U.state,end:1,duration:this.noAnimation?0:200*x,tween:"linear",group:{top:!0}}])):U&&U.tp===1&&this.hideItem(k,x),U&&U.state[`ox_${k}`]>0){const H=(U.xi-e.x1+T/2)*b+n;if(this.ctx.globalAlpha=U.state[`ox_${k}`]*t,H+y/2>=d.l&&H-y/2<=d.l+d.w){const E=(H+d.l)*i;this.ctx.fillText(s.data.datesShort[X],E,(d.t+9)*i)}}}for(const X in this.items){const N=this.items[X];N.tp===1&&(N.xi<e.x1-n/b||N.xi>e.x2+h/b)&&this.hideItem(X,x)}if(this.ctx.globalAlpha=1,!s.data.subchart.show)return;let st;o&&m===1&&M--,M<u&&(M=u),s.data.datesRange[u]===s.data.datesRange[M]?st=s.data.datesRange[u]:st=s.data.datesRange[u]+" — "+s.data.datesRange[M];let tt=s.settings.DATES_FONT_SIZE;tt||(tt=13,d.w<375&&(tt=11)),this.ctx.font=`${s.settings.FONT[s.settings.DATES_WEIGHT]} ${tt*i}px ${s.settings.FONT.family}`,this.ctx.textAlign=s.settings.DATES_SIDE,this.ctx.fillStyle=s.settings.COLORS.dates,this.ctx.fillText(st,(p.l+(s.settings.DATES_SIDE==="right"?p.w:0))*i,(p.t+p.h-7)*i)}}class ss{constructor(t){this.deleteItem=s=>{delete this.items[s.id]},this.opts=t,this.ctx=t.ctx,this.uuid=1,this.items={},this.setAnimation(!1),this.setForceUpdate(!1)}onResize(){this.setAnimation(!1),this.setForceUpdate(!1)}setDarkMode(t){this.isDarkMode=t}setAnimation(t){this.noAnimation=!t}setForceUpdate(t){this.forceUpdate=t}render(t){let s,i;this.opts.pairY?(s=this.calcAxisData("y1_0","y2_0"),i=this.calcAxisData("y1_1","y2_1"),i.needAnimation&&!s.needAnimation||this.opts.state.o_0<1?this.updateAxisState("y1_1","y2_1","numRight",i,s,i):this.updateAxisState("y1_0","y2_0","numLeft",s,s,i)):(s=this.calcAxisData("y1","y2"),this.updateAxisState("y1","y2","numLeft",s,s,s)),this.renderState(t)}calcAxisData(t,s){const i=this.opts.state,a=this.opts.settings.PADD[0],e=this.opts.settings.PADD[2];Math.floor(this.opts.settings.Y_AXIS_RANGE);let h=!1;const n=this.opts.animator.get(t),l=this.opts.animator.get(s),d=n?n.end:i[t],p=l?l.end:i[s],o=Math.round((p-d)/this.opts.settings.Y_AXIS_RANGE),m=d,r=i[s]-i[t],c=i[t]>d?i[t]/d:d/i[t],u=i[s]>p?i[s]/p:p/i[s],M=p-d,w=(this.opts.state.dims.axisYLines.h-a-e)/r,y=(this.opts.state.dims.axisYLines.h-a-e)/M;return(c>1.05||u>1.05||this.forceUpdate)&&(h=!0),h=this.items[0]&&h&&!this.noAnimation&&!this.animationInProgress,{needAnimation:h,y1:d,y2:p,yRealStep:o,yRealStart:m,yScaleCur:w,yScaleEnd:y}}updateAxisState(t,s,i,a,e,h){const n=this.opts;n.settings,n.settings.dpi;const l=n.state;n.settings.PADD[0];const d=n.settings.PADD[2];n.settings.PADD[3],n.settings.PADD[1];const p=n.animator;let o;const m=Math.floor(n.settings.Y_AXIS_RANGE);let r=!1;const c=this.opts.state.dims.axisYLines;a.needAnimation&&(this.animationInProgress=!0);for(let u=0;u<=m;++u){const M=a.yRealStart+Math.round(a.yRealStep*u),w=e.yRealStart+Math.round(e.yRealStep*u),y=h.yRealStart+Math.round(h.yRealStep*u),g=dt("yTickFormatter",n.data,l.zoomMorph),f=g(w,e.yRealStep),T=g(Math.max(y,0),h.yRealStep,!0);if(a.needAnimation){const R=c.t+c.h-d-(M-a.y1)*a.yScaleEnd,$=c.t+c.h-d-(this.items[u][i]-a.y1)*a.yScaleEnd,D=c.t+c.h-d-(M-l[t])*a.yScaleCur,S=c.t+c.h-d-(M-a.y1)*a.yScaleEnd;if(Math.abs($-S)<1)this.items[u]={numLeft:w,strLeft:f,numRight:y,strRight:T,y:S};else{r=!0,this.uuid++,o={animated:!0,strLeft:this.items[u].strLeft,strRight:this.items[u].strRight,oProp:`oyt_${this.uuid}`,yProp:`yyt_${this.uuid}`,state:{id:`t_${this.uuid}`}},o.state[o.oProp]=1,o.state[o.yProp]=R,this.items[o.state.id]=o,p.add([{prop:o.oProp,state:o.state,end:0,duration:this.noAnimation?0:200,tween:"linear",group:{top:!0}},{prop:o.yProp,state:o.state,end:$,duration:this.noAnimation?0:this.forceUpdate?333:500,fixed:!this.forceUpdate,tween:this.forceUpdate?null:"exp",speed:.18,group:{top:!0},cbEnd:this.deleteItem}]),delete this.items[u],this.uuid++,o={animated:!0,strLeft:f,strRight:T,oProp:`oy_${u}`,yProp:`yy_${u}`,state:{id:u,numLeft:w,strLeft:f,numRight:y,strRight:T}},o.state[o.oProp]=0,o.state[o.yProp]=D,this.items[o.state.id]=o;const L=[{prop:o.oProp,state:o.state,end:1,duration:this.noAnimation?0:200,tween:"linear",group:{top:!0}},{prop:o.yProp,state:o.state,end:S,duration:this.noAnimation?0:this.forceUpdate?333:500,fixed:!this.forceUpdate,tween:this.forceUpdate?null:"exp",speed:.18,group:{top:!0},cbEnd:_=>{this.items[_.id]={numLeft:_.numLeft,strLeft:_.strLeft,numRight:_.numRight,strRight:_.strRight,y:_[`yy_${_.id}`]},clearTimeout(this.animationEndTimeout),this.animationEndTimeout=window.setTimeout(()=>{this.animationInProgress=!1},30)}}];p.add(L)}}else this.items[u]&&this.items[u].animated?(this.items[u].numLeft=w,this.items[u].strLeft=f,this.items[u].numRight=y,this.items[u].strRight=T,this.items[u].state.numLeft=w,this.items[u].state.strLeft=f,this.items[u].state.numRight=y,this.items[u].state.strRight=T):this.items[u]={numLeft:w,strLeft:f,numRight:y,strRight:T,y:c.t+c.h-d-(M-a.y1)*a.yScaleEnd}}a.needAnimation&&!r&&(this.animationInProgress=!1),this.forceUpdate=!1}renderState(t){const s=this.opts.settings.dpi,i=this.opts.state.dims.axisYLeft,a=this.opts.state.dims.axisYRight,e=this.opts.state.dims.axisYLines,h=this.opts.data.ys;this.ctx.font=`${this.opts.settings.FONT.normal} ${11*s}px ${this.opts.settings.FONT.family}`,this.ctx.strokeStyle=this.opts.settings.COLORS.grid,this.ctx.lineWidth=1*s,this.ctx.lineCap="square",this.ctx.lineJoin="square";for(const n in this.items){const l=this.items[n];let d,p;l.animated?(p=l.state[l.yProp],d=l.state[l.oProp]):(p=l.y,d=1),p-6>=0&&p-16<=i.h&&(this.ctx.globalAlpha=d*(this.opts.pairY?this.opts.state.o_0:1)*t,this.ctx.textAlign="left",this.opts.pairY?this.ctx.fillStyle=this.isDarkMode?h[0].colors_n[1]:h[0].colors_d[1]:this.ctx.fillStyle=this.opts.settings.COLORS.axis.y,this.ctx.fillText(l.strLeft,i.l*s,(p-7)*s),this.opts.pairY&&(this.ctx.globalAlpha=d*this.opts.state.o_1*t,this.ctx.textAlign="right",this.ctx.fillStyle=this.isDarkMode?h[1].colors_n[1]:h[1].colors_d[1],this.ctx.fillText(l.strRight,(a.l+a.w)*s,(p-7)*s))),p=(p<<0)-.5,p>=0&&p<=i.h&&(this.ctx.beginPath(),this.ctx.globalAlpha=d*t,this.ctx.moveTo(e.l*s,p*s),this.ctx.lineTo((e.l+e.w)*s,p*s),this.ctx.stroke())}this.ctx.globalAlpha=1}}class es{constructor(t){this.opts=t,this.filteredX1=[],this.filteredX2=[],this.filteredJ=[],this.prevY=[],this.$canvas=document.createElement("canvas"),this.ctx=this.$canvas.getContext("2d",{alpha:!1})}onResize(){const t=this.opts.settings.dpi,s=this.opts.additional.mini?this.opts.state.dims.mini:this.opts.state.dims.graph;this.$canvas.width=s.w*t,this.$canvas.height=s.h*t,this.cached=""}setDarkMode(t){this.isDarkMode=t}render(){let t,s,i,a,e,h,n,l,d,p;const o=this.opts,m=o.data.ys,r=o.state,c=o.additional.mini,u=c?r.xg1:r.x1,M=c?r.xg2:r.x2,w=o.settings;this.w,this.h;const y=w[`PADD${c?"_MINI_BAR":""}`][0],g=w[`PADD${c?"_MINI_BAR":""}`][1],f=w[`PADD${c?"_MINI_BAR":""}`][2],T=w[`PADD${c?"_MINI_BAR":""}`][3],R=o.data.x,$=o.settings.dpi;let D,S;const L=this.ctx,_=c?r.dims.mini:r.dims.graph,b=r.zoomMode,I=r.detailInd1,x=r.detailInd2,A=r.zoomMorph===void 0?0:r.zoomMorph,Y=this.filteredX1,q=this.filteredX2,st=this.filteredJ,tt=this.prevY,X=m.length,N=[_.w,_.h,c?r.xg1:r.x1,c?r.xg2:r.x2,this.isDarkMode,b];for(c||(N.push(r.y1),N.push(r.y2)),t=0;t<X;t++)N.push(c?r[`om_${t}`]:r[`o_${t}`]),N.push(r[`f_${t}`]);const it=N.join(",");if(it===this.cached&&(this.opts.ctx.drawImage(this.$canvas,_.l*$,_.t*$),c))return;n=(_.w-g-T)/(M-u+this.opts.data.mainPeriodLen*(1-A)),D=Math.floor(J(R,u-T/n)),S=Math.ceil(J(R,M+g/n)),b&&A===1&&(D<this.opts.state.xg1Ind&&(D=this.opts.state.xg1Ind),S>this.opts.state.xg2Ind&&(S=this.opts.state.xg2Ind-1)),n*=$;const k=T*$-u*n,U=(_.h-f)*$,H=this.opts.data.mainPeriodLen*n,E=this.opts.data.detailPeriodLen*n;if(it!==this.cached){L.fillStyle=this.opts.settings.COLORS.background,L.fillRect(0,0,_.w*$,_.h*$);let F=0;for(s=D;s<=S;s++){let C;b&&s>=I&&s<=x?C=E:C=H;const O=Math.round(R[s]*n+k),G=Math.round(R[s]*n+k+C);G-O>0&&(Y[F]=O,q[F]=G,st[F]=s,tt[F]=0,F++)}for(t=0;t<X;t++)if(a=c?r[`om_${t}`]:r[`o_${t}`],a>0){i=m[t].y,p=m[t].yFrom,e=c?r.y1m:r.y1,h=c?r.y2m:r.y2,l=$*(_.h-y-f)/(h-e),d=(_.h-f)*$+e*l;const C=a*l;L.fillStyle=this.isDarkMode?m[t].colors_n[0]:m[t].colors_d[0],L.globalAlpha=r[`f_${t}`]*.9+.1;let O;if(L.beginPath(),L.moveTo(Math.round(R[S]*n+k+(A===1?E:H)),Math.round(U)),t>0)for(s=F-1;s>=0;s--){const G=U-tt[s];L.lineTo(q[s],Math.round(G)),L.lineTo(Y[s],Math.round(G))}else L.lineTo(Math.round(R[D]*n+k),Math.round(U));for(s=0;s<F;s++){const G=st[s];b?G>=I&&G<=x?O=p[G]+A*(i[G]-p[G]):O=i[G]+A*(i[I]-i[G]):O=i[G],O=O||0;const rt=d-O*C,pt=U-rt;tt[s]+=pt,L.lineTo(Y[s],Math.round(U-tt[s])),L.lineTo(q[s],Math.round(U-tt[s]))}L.closePath(),L.fill()}L.globalAlpha=1,this.opts.ctx.drawImage(this.$canvas,_.l*$,_.t*$)}if(r.barInd>-1&&!c){this.opts.ctx.fillStyle=this.opts.settings.COLORS.barsSelectionBackground,this.opts.ctx.globalAlpha=r.barO,this.opts.ctx.fillRect(0,0,_.w*$,_.h*$);let F=0;for(t=0;t<X;t++)if(a=r[`o_${t}`],a>0){i=m[t].y,p=m[t].yFrom,e=r.y1,h=r.y2,l=$*(_.h-y-f)/(h-e),d=(_.h-f)*$+e*l;const C=a*l;this.opts.ctx.fillStyle=this.isDarkMode?m[t].colors_n[0]:m[t].colors_d[0],this.opts.ctx.globalAlpha=r[`f_${t}`]*.9+.1;let O,G;b?r.barInd>=I&&r.barInd<=x?(O=p[r.barInd]+A*(i[r.barInd]-p[r.barInd]),G=E):(G=H,O=i[r.barInd]+A*(i[I]-i[r.barInd])):(O=i[r.barInd],G=H),O=O||0;const rt=U-(d-O*C)+F;this.opts.ctx.fillRect(Math.round(R[r.barInd]*n+k),Math.round(U-F+_.t*$),Math.max(Math.round(G),1),Math.round(F)-Math.round(rt)),F=rt}L.globalAlpha=1}this.cached=it}}class is{constructor(t){this.opts=t,this.$canvas=document.createElement("canvas"),this.$canvas.className="tchart--graph-canvas",this.ctx=this.$canvas.getContext("2d"),t.$parent.appendChild(this.$canvas),this.deviceSpeed=void 0}onResize(){const t=this.opts.settings.dpi,s=this.opts.state.dims.composer;this.$canvas.width=s.w*t,this.$canvas.height=s.h*t,this.render({top:!0,bottom:!0})}setDarkMode(t){this.isDarkMode=t,this.onResize()}render(t){if(this.deviceSpeed===void 0){const s=performance.now(),i=this.opts.state.x1;this.opts.state.x1=this.opts.state.xMainMin,this.renderInner(t);const a=performance.now();this.opts.state.x1=i,this.deviceSpeed=(a-s)/(this.opts.graphStyle==="line"||this.opts.graphStyle==="step"?1.5:2)/(this.opts.data.x.length*this.opts.data.ys.length),this.opts.state.deviceSpeed=this.deviceSpeed}this.renderInner(t)}renderInner(t){const s=this.opts.state.dims,i=this.opts.state,a=this.ctx,e=this.opts.settings.dpi,h=this.opts.settings,n=h.PADD,l=i.zoomMorph===void 0?0:i.zoomMorph,d=this.opts.graphStyle==="area"&&i.zoomMode&&l<1,p=this.opts.graphStyle==="area"&&i.zoomMode&&l===1;if(this.opts.data.master&&(this.$canvas.style.opacity=""+i.masterVisibility),this.opts.data.slave&&(this.$canvas.style.opacity=""+i.slaveVisibility,this.opts.chart.$el.style.visibility=i.slaveVisibility>0?"visible":"hidden"),t.top){if(a.clearRect(s.dates.l*e,s.dates.t*e,s.dates.w*e,s.dates.h*e),(this.opts.graphStyle==="line"||this.opts.graphStyle==="step"||this.opts.graphStyle==="area"&&l>0||this.opts.data.slave&&i.slaveVisibility<1||this.opts.data.master&&i.masterVisibility<1)&&(p?a.clearRect(s.graph.l*e,(s.graph.t-18)*e,s.graph.w*e,(s.graph.h+30)*e):a.clearRect(s.graph.l*e,s.graph.t*e,s.graph.w*e,s.graph.h*e)),(this.opts.graphStyle==="area"&&l===0||this.opts.graphStyle==="bar")&&(a.clearRect(s.graph.l*e,s.graph.t*e,s.graph.w*e,(h.PADD[0]+4)*e),a.clearRect(s.graph.l*e,(s.graph.t+n[0])*e,n[3]*e,(s.graph.h-n[0]-n[2])*e),a.clearRect(s.graph.l*e,(s.graph.t+s.graph.h-n[2])*e,s.graph.w*e,n[2]*e),a.clearRect((s.graph.l+s.graph.w-n[1]-1)*e,(s.graph.t+n[0])*e,(n[1]+1)*e,(s.graph.h-n[0]-n[2])*e)),!d&&!p&&(a.save(),a.beginPath(),a.rect(s.graph.l*e,s.graph.t*e,s.graph.w*e,s.graph.h*e),a.clip()),this.opts.data.master&&i.masterVisibility<1){a.save();const m=(1-i.masterVisibility)*5+1;a.translate(s.graph.w*i.zoomSpecialOrigin*(1-m),0),a.scale(m,1)}if(this.opts.data.slave&&i.slaveVisibility<1){a.save();const m=i.slaveVisibility;a.translate(s.graph.w*i.zoomSpecialOrigin*(1-m),0),a.scale(m,1)}let o=1;if(this.opts.graphStyle==="area"&&i.zoomMode&&(o=1-l),d){a.save();const m=h.PIE_RADIUS,r=s.graph.w+l*(m*2-s.graph.w),c=s.graph.h-42+l*(m*2-s.graph.h+42);Bt(a,e,r,c,(s.graph.w-r)/2+s.graph.l,(s.graph.h-42-c)/2+s.graph.t+23,l*m),a.clip()}this.opts.chart.graph.render(),d&&a.restore(),this.opts.data.master&&i.masterVisibility<1&&a.restore(),this.opts.data.slave&&i.slaveVisibility<1&&a.restore(),this.opts.chart.axisY.render(o),this.opts.chart.fade.render(),!d&&!p&&a.restore(),this.opts.chart.axisX.render(o)}if(t.bottom){a.clearRect(s.graph.l*e,(s.handle.t-1)*e,s.graph.w*e,(s.handle.h+2)*e);let o=this.opts.data.subchart.show;const m=!this.opts.data.master&&!this.opts.data.slave&&this.opts.data.details&&this.opts.data.subchart.show!==this.opts.data.details.subchart.show;m&&(o?o=l<1:o=l>0),o&&(a.save(),ft(a,e,s.mini.w,s.mini.h,s.mini.l,s.mini.t,7),a.clip(),this.opts.chart.mini.render(),a.restore(),this.opts.chart.handle.render()),m&&l>0&&l<1&&(a.fillStyle=this.opts.settings.COLORS.background,a.globalAlpha=this.opts.data.subchart.show?l:1-l,a.fillRect(s.graph.l*e,(s.handle.t-1)*e,s.graph.w*e,(s.handle.h+2)*e),a.globalAlpha=1)}}}class as{constructor(t){this.opts=t,this.ctx=t.ctx,this.opts.graphStyle!=="area"&&(this.$fadeTop=document.createElement("canvas"),this.ctxFadeTop=this.$fadeTop.getContext("2d"),this.opts.graphStyle!=="bar"&&(this.$fadeBottom=document.createElement("canvas"),this.ctxFadeBottom=this.$fadeBottom.getContext("2d")))}onResize(){const t=this.opts.settings.dpi,s=this.opts.state.dims.fadeTop,i=this.opts.state.dims.fadeBottom,a=this.opts.settings.COLORS.backgroundRgb.join(", ");if(this.opts.graphStyle!=="area"){const e=this.ctxFadeTop.createLinearGradient(0,0,0,s.h*t);if(e.addColorStop(0,`rgba(${a}, 1)`),e.addColorStop(1,`rgba(${a}, 0)`),this.$fadeTop.width=s.w*t,this.$fadeTop.height=s.h*t,this.ctxFadeTop.fillStyle=e,this.ctxFadeTop.fillRect(0,0,s.w*t,s.h*t),this.opts.graphStyle!=="bar"){const h=this.ctxFadeBottom.createLinearGradient(0,0,0,i.h*t);h.addColorStop(0,`rgba(${a}, 0)`),h.addColorStop(1,`rgba(${a}, 1)`),this.$fadeBottom.width=i.w*t,this.$fadeBottom.height=i.h*t,this.ctxFadeBottom.fillStyle=h,this.ctxFadeBottom.fillRect(0,0,i.w*t,i.h*t)}}}setDarkMode(t){this.isDarkMode=t,this.onResize()}render(){const t=this.opts.settings.dpi,s=this.opts.state.dims.fadeTop,i=this.opts.state.dims.fadeBottom;this.$fadeTop&&this.ctx.drawImage(this.$fadeTop,s.l*t,s.t*t),this.$fadeBottom&&this.ctx.drawImage(this.$fadeBottom,i.l*t,i.t*t)}}class Dt{constructor(t){this.onDragStart=i=>{this.skipMoveEnd=!0,clearTimeout(this.pointerTimeout),!(this.isTouch&&i.touches.length>1||(this.scroll=void 0,this.x=this.isTouch?i.touches[0].pageX:i.pageX,this.y=this.isTouch?i.touches[0].pageY:i.pageY,this.dX=0,this.dY=0,this.pageX=this.x,this.pageY=this.y,delete this.prevDx,delete this.prevDy,this.opts.onDragStart({pageX:this.x,pageY:this.y,isTouch:this.isTouch})))&&(this.skipMoveEnd=!1)},this.onDragMove=i=>{if(this.skipMoveEnd||this.scroll==="v")return;const a=this.isTouch?i.touches[0].pageX:i.pageX,e=this.isTouch?i.touches[0].pageY:i.pageY;this.dX=a-this.x,this.dY=e-this.y,this.pageX=a,this.pageY=e,this.isTouch&&(this.scroll==="h"?!this.opts.noPrevent&&i.preventDefault():(Math.abs(this.dX)>5||Math.abs(this.dY)>5)&&(this.scroll=Math.abs(this.dX)>Math.abs(this.dY)?"h":"v")),(this.prevDx!==this.dX||this.prevDy!==this.dY)&&(this.opts.onDragMove&&this.opts.onDragMove({canceled:this.scroll==="v",d:this.dX,pageX:this.pageX,pageY:this.pageY,isTouch:this.isTouch}),this.prevDx=this.dX,this.prevDy=this.dY)},this.onDragEnd=i=>{this.skipMoveEnd||(this.skipMoveEnd=!0,this.opts.onDragEnd&&this.opts.onDragEnd({isTouch:this.isTouch,e:i}))},this.opts=t,this.isTouch=bt(),this.skipMoveEnd=!0;const s=t.useElForMove?t.$el:window;t.$el.addEventListener(this.isTouch?"touchstart":"mousedown",this.onDragStart,{passive:!1}),s.addEventListener(this.isTouch?"touchmove":"mousemove",this.onDragMove,{passive:!1}),s.addEventListener(this.isTouch?"touchend":"mouseup",this.onDragEnd,{passive:!1})}}class hs{constructor(t){this.onMouseLeave=()=>{this.$canvas.classList.remove("tchart--graph-canvas__handle-pointer"),this.$canvas.classList.remove("tchart--graph-canvas__handle-grab"),this.$canvas.classList.remove("tchart--graph-canvas__handle-col-resize"),delete this.canvasPos},this.onMouseMove=s=>{this.canvasPos=this.canvasPos||ut(this.$canvas);const i=s.pageX-this.canvasPos.x,a=s.pageY-this.canvasPos.y,e=this.getTp(i-this.opts.settings.PADD[3],a-(this.opts.state.dims.composer.h-this.opts.settings.MINI_GRAPH_HEIGHT-this.opts.settings.MINI_GRAPH_BOTTOM),!1),h={"":"",both:this.opts.settings.isIE?"pointer":"grab",start:"col-resize",end:"col-resize"};this.onMouseLeave(),h[e]&&this.$canvas.classList.add("tchart--graph-canvas__handle-"+h[e])},this.opts=t,this.ctx=t.ctx,this.isTouch=bt(),this.$canvas=t.$canvas,this.drag=new Dt({$el:this.$canvas,onDragStart:s=>{this.canvasPos=ut(this.$canvas);const i=s.pageX-this.canvasPos.x,a=s.pageY-this.canvasPos.y;return this._x1=t.state.x1,this._x2=t.state.x2,this.constrainHandleSize(!1),this.tp=this.getTp(i-t.settings.PADD[3],a-(this.opts.state.dims.composer.h-t.settings.MINI_GRAPH_HEIGHT-t.settings.MINI_GRAPH_BOTTOM),s.isTouch),this.firstMove=!0,!this.tp},onDragMove:s=>{this.onDragMove(s.d),this.firstMove=!1},onDragEnd:s=>{}}),this.trackMouse(!0)}getTp(t,s,i){const a=this.opts.state.dims.handle,e=this.opts.state,h=this.opts.state.zoomMode;if(s<0||s>a.h)return"";let n=i?a.w*.3:10;i&&n<14&&(n=14),i&&n>30&&(n=30);const l=this.prevX1+(i?e.x1===e.xg1?-5:-15:0);let d=l+n;const p=this.prevX2+(i?e.x2===e.xg2?5:15:0);let o=p-n;return Math.abs(e.x2-e.x1-(h?this.opts.data.mainPeriodLen:this.minRange))<.01&&(e.x2===e.xg2&&(o=p+1),e.x1===e.xg1&&(d=l-1)),t>d&&t<o?"both":t>=l&&t<=d?"start":t>=o&&t<=p?"end":""}trackMouse(t){this.isTouch||(this.$canvas.addEventListener("mousemove",this.onMouseMove),this.$canvas.addEventListener("mouseleave",this.onMouseLeave))}onResize(t){this.constrainHandleSize(!0)}setDarkMode(t){this.isDarkMode=t}constrainHandleSize(t){const s=32/(this.opts.state.dims.handle.w/(this.opts.state.xg2-this.opts.state.xg1));let i=this.opts.state.x1,a=this.opts.state.x2;this.opts.state.xg1;const e=this.opts.state.xg2;this.minRange=s,a-i<s&&(a=i+s,a>e&&(a=e,i=a-s),t&&this.opts.additional.cb(i,a,"constraint"))}onDragMove(t){const s=this.opts.state.dims.handle,i=this.tp,a=this.opts.state,e=t/s.w*(a.xg2-a.xg1);let h,n;const l=this._x1,d=this._x2;i==="both"&&(h=l+e,n=d+e,h<a.xg1&&(h=a.xg1,n=a.xg1+d-l),n>a.xg2&&(h=a.xg2-(d-l),n=a.xg2)),i==="start"&&(n=a.x2,h=Math.min(Math.max(l+e,a.xg1),n-this.minRange)),i==="end"&&(h=a.x1,n=Math.max(Math.min(d+e,a.xg2),h+this.minRange)),!(a.x1===h&&a.x2===n)&&this.opts.additional.cb(h,n,i,this.firstMove)}render(){const t=this.opts.state.dims.handle,s=this.opts.settings.dpi,i=this.opts.state,a=1/(i.xg2-i.xg1),e=Math.round((i.x1-i.xg1)*a*t.w),h=Math.round((i.x2-i.xg1)*a*t.w),n=this.ctx;n.fillStyle=this.opts.settings.COLORS.miniMask,ft(n,s,e+4,t.h-2,t.l,t.t+1,[7,0,0,7]),n.fill(),ft(n,s,t.w-h+4,t.h-2,t.l+h-4,t.t+1,[0,7,7,0]),n.fill(),n.fillStyle=this.opts.settings.COLORS.miniFrame,ft(n,s,10,t.h,t.l+e,t.t,[7,0,0,7]),n.fill(),ft(n,s,10,t.h,t.l+h-10,t.t,[0,7,7,0]),n.fill(),n.fillRect((t.l+e+10)*s,t.t*s,(h-e-20)*s,s),n.fillRect((t.l+e+10)*s,(t.t+t.h-1)*s,(h-e-20)*s,s),n.strokeStyle="#fff",this.ctx.lineCap="round",this.ctx.lineJoin="round",this.ctx.lineWidth=2*s,n.beginPath(),n.moveTo((t.l+e+5)*s,(t.t+17)*s),n.lineTo((t.l+e+5)*s,(t.t+25)*s),n.moveTo((t.l+h-5)*s,(t.t+17)*s),n.lineTo((t.l+h-5)*s,(t.t+25)*s),n.stroke(),this.prevX1=e,this.prevX2=h}}class Rt{constructor(t){this.opts=t,this.$canvas=document.createElement("canvas"),this.ctx=this.$canvas.getContext("2d",{alpha:!0})}onResize(){const t=this.opts.settings.dpi,s=this.opts.additional.mini?this.opts.state.dims.mini:this.opts.state.dims.graph;this.$canvas.width=s.w*t,this.$canvas.height=s.h*t,this.cached="",this.ctx.fillStyle=this.opts.settings.COLORS.background,this.ctx.fillRect(0,0,s.w*t,s.h*t)}setDarkMode(t){this.isDarkMode=t}render(){let t,s,i,a,e,h,n,l,d,p,o;const m=this.opts,r=m.data.ys,c=m.state,u=m.additional.mini,M=u||m.data.master&&c.masterVisibility<1&&c.masterVisibility>0||m.data.slave&&c.slaveVisibility<1&&c.slaveVisibility>0,w=u?c.xg1:c.x1,y=u?c.xg2:c.x2,g=m.settings,f=g[`PADD${u?"_MINI":""}`][0],T=g[`PADD${u?"_MINI":""}`][1],R=g[`PADD${u?"_MINI":""}`][2],$=g[`PADD${u?"_MINI":""}`][3],D=m.data.x,S=m.settings.dpi;let L,_;const b=M?this.ctx:this.opts.ctx,I=u?c.dims.mini:c.dims.graph,x=c.zoomMode,A=c.detailInd1,Y=c.detailInd2,q=c.zoomMorph===void 0?0:c.zoomMorph,st=r.length,tt=m.graphStyle==="step";n=(I.w-T-$)/(y-w+(tt?this.opts.data.mainPeriodLen*(1-q):0)),L=Math.floor(J(D,w-$/n)),_=Math.ceil(J(D,y+T/n)),n*=S;const X=($+(M?0:I.l))*S-w*n;tt&&x&&q===1&&(L<this.opts.state.xg1Ind&&(L=this.opts.state.xg1Ind),_>this.opts.state.xg2Ind&&(_=this.opts.state.xg2Ind-1));let N;const it=this.opts.data.mainPeriodLen*n,k=this.opts.data.detailPeriodLen*n;if(M){const E=[I.w,I.h,u?c.xg1:c.x1,u?c.xg2:c.x2,this.isDarkMode,x];for(u||(E.push(c.y1),E.push(c.y2)),t=0;t<st;t++)E.push(u?c[`om_${t}`]:c[`o_${t}`]),E.push(c[`f_${t}`]);const F=E.join(",");if(F===this.cached){this.opts.ctx.drawImage(this.$canvas,I.l*S,I.t*S);return}this.cached=F,b.clearRect(0,0,I.w*S,I.w*S)}const U=(m.additional.mini?1:m.data.strokeWidth==="auto"?st>5?1:2:m.data.strokeWidth)*S,H=U%2===0?0:.5;for(b.lineWidth=U,b.lineCap=m.additional.mini?"square":"round",b.lineJoin=m.additional.mini?"square":"round",t=0;t<st;t++){if(a=u?c[`om_${t}`]:c[`o_${t}`],p=c[`e_${t}`],a<=0)continue;i=r[t].y,o=r[t].yFrom,m.pairY?(e=u?c[`y1m_${t}`]:c[`y1_${t}`],h=u?c[`y2m_${t}`]:c[`y2_${t}`]):u?p&&a<1?(e=c.y1m_show,h=c.y2m_show):!p&&a<1?(e=c.y1m_hidd,h=c.y2m_hidd):(e=c.y1m,h=c.y2m):(e=c.y1,h=c.y2),l=S*(I.h-f-R)/(h-e),d=(I.h-R+(M?0:I.t))*S+e*l,b.beginPath(),b.strokeStyle=this.isDarkMode?r[t].colors_n[0]:r[t].colors_d[0],b.globalAlpha=a*(c[`f_${t}`]*.9+.1);let E,F,C=Number.MAX_VALUE,O=-Number.MAX_VALUE,G=-Number.MAX_VALUE,rt,pt=!1,yt=!0;for(s=L;s<=_;s++){if(x?s>=A&&s<=Y?(E=o[s]+q*(i[s]-o[s]),N=k):(E=i[s]+q*(i[A]-i[s]),N=it):(E=i[s],N=it),isNaN(E)){yt=!0;continue}F=D[s]*n+X<<0;const ot=d-E*l<<0;F>G||tt&&s===Y+1?(pt&&(rt===C?(b.moveTo(G+H,O-H),b.lineTo(G+H,C-H)):(b.moveTo(G+H,C-H),b.lineTo(G+H,O-H),rt!==O&&b.moveTo(G+H,rt-H)),pt=!1),yt&&(b.moveTo(F+H,ot-H),yt=!1),C=ot,O=ot,b.lineTo(F+H,ot-H),tt&&b.lineTo((D[s]*n+N+X<<0)+H,ot-H)):(C=Math.min(C,ot),O=Math.max(O,ot),pt=!0),G=F,rt=ot}pt&&(b.moveTo(G+H,C-H),b.lineTo(G+H,O-H)),b.stroke()}b.globalAlpha=1,M&&this.opts.ctx.drawImage(this.$canvas,I.l*S,I.t*S)}}class os{constructor(t){this.preventClick=!1,this.opts=t,this.isTouch=bt(),this.enabled=t.data.ys.length,this.enabled===1&&!t.data.forceLegend&&(t.$parent.style.display="none"),this.switchers=t.data.ys.map((s,i,a)=>{const e=document.createElement("div");e.className="tchart--switcher",i===0?e.classList.add("tchart--switcher__first"):i===a.length-1&&e.classList.add("tchart--switcher__last"),t.state[`e_${i}`]?e.classList.toggle("tchart--switcher__active"):this.enabled--,e.setAttribute("data-label",s.label),t.$parent.appendChild(e);const h=document.createElement("span");h.className="tchart--switcher-text",h.textContent=s.label,e.appendChild(h),this.isTouch||(e.addEventListener("mouseenter",()=>{t.state[`e_${i}`]&&t.additional.onEnter(i)}),e.addEventListener("mouseleave",()=>{t.state[`e_${i}`]&&t.additional.onLeave(i)})),e.addEventListener("click",p=>{if(this.preventClick){this.preventClick=!1;return}const o=e.classList.contains("tchart--switcher__active");if(o&&this.enabled===1){e.classList.add("tchart--switcher__denied"),clearTimeout(this.timeout),this.timeout=setTimeout(()=>{e.classList.remove("tchart--switcher__denied")},500);return}this.isTouch||(o?t.additional.onLeave(i):t.additional.onEnter(i)),t.additional.onClick(!o,i)});let n,l,d;return this.drag=new Dt({$el:e,noPrevent:!0,useElForMove:!0,onDragStart:p=>{n=p.pageX,l=p.pageY,d=setTimeout(()=>{this.preventClick=!0,this.isTouch||t.additional.onEnter(i),t.additional.onLongTap(i)},500)},onDragMove:p=>{(Math.abs(n-p.pageX)>5||Math.abs(l-p.pageY)>5)&&clearTimeout(d)},onDragEnd:p=>{clearTimeout(d)}}),e}),this.updateColors()}onResize(){}updateColors(){const t=this.opts.data.ys;for(let s=0;s<this.switchers.length;s++)this.switchers[s].style.color=this.isDarkMode?t[s].colors_n[1]:t[s].colors_d[1]}setDarkMode(t){this.isDarkMode=t,this.updateColors()}render(t){this.enabled=0;for(let s=0;s<this.switchers.length;s++)t[s]?(this.enabled++,this.switchers[s].classList.add("tchart--switcher__active")):this.switchers[s].classList.remove("tchart--switcher__active")}}class ns{constructor(t){this.onTipClick=s=>{if(this.prevXInd===void 0||!this.opts.additional.onClick||!this.opts.data.hasDetail||this.opts.state.zoomMode||this.opts.state.zoomModeSpecial||(s.stopPropagation(),this.$tip.classList.contains("tchart--tip__loading")))return;const i=this.opts.data.x[this.prevXInd];if(!this.opts.data.detailsFunc){this.toggle(!1,!0),this.opts.additional.onClick(!0,i);return}if(this.$tip.classList.remove("tchart--tip__error"),this.$tip.classList.add("tchart--tip__loading"),this.cache[i]){this.toggle(!1,!0),this.opts.additional.onClick(!0,i,this.cache[i]),this.$tip.classList.remove("tchart--tip__loading");return}this.abortDetailCallbacks();const a=this.opts.data.detailsFunc(i);this.detailCallbacks=this.detailCallbacks||[];const e=n=>{if(!e.cancelled){if(this.$tip.classList.remove("tchart--tip__loading"),!n||!n.columns){this.$tip.classList.add("tchart--tip__error");return}this.toggle(!1,!0),this.opts.additional.onClick(!0,i,n),this.cache[i]=n}},h=n=>{h.cancelled||(console.log("error:",n),this.$tip.classList.remove("tchart--tip__loading"),this.$tip.classList.add("tchart--tip__error"))};this.detailCallbacks.push(e),this.detailCallbacks.push(h),a.then(e).catch(h)},this.onMouseLeave=()=>{this.$canvas.classList.remove("tchart--graph-canvas__tip-pointer"),delete this.canvasPos},this.onMouseMove=s=>{this.canvasPos=this.canvasPos||ut(this.$canvas);const i=s.pageX-this.canvasPos.x,a=s.pageY-this.canvasPos.y,e=this.opts.state.dims.tip,h=this.getTp(i,a-e.t,!1);this.onMouseLeave(),h&&this.$canvas.classList.add("tchart--graph-canvas__tip-pointer")},this.onBodyClick=s=>{s.target!==this.$canvas&&this.toggle(!1)},this.updateTipScrollClasses=()=>{this.$tipScroller.scrollHeight>this.$tipScroller.offsetHeight?this.$tip.classList.add("tchart--tip__scroll"):this.$tip.classList.remove("tchart--tip__scroll"),this.$tipScroller.scrollTop<=0?this.$tip.classList.remove("tchart--tip__has_less"):this.$tip.classList.add("tchart--tip__has_less"),this.$tipScroller.scrollTop>=this.$tipScroller.scrollHeight-this.$tipScroller.offsetHeight?this.$tip.classList.remove("tchart--tip__has_more"):this.$tip.classList.add("tchart--tip__has_more")},this.opts=t,this.shown=!1,this.isTouch=bt(),this.$canvas=t.$canvas,this.cache={},this.$tip=document.createElement("div"),this.$tip.className="tchart--tip",t.$parent.appendChild(this.$tip),this.$tipDt=document.createElement("h6"),this.$tipDt.className="tchart--tip-header",this.$tip.appendChild(this.$tipDt),this.$tipDtText=document.createTextNode(""),this.$tipDt.appendChild(this.$tipDtText),this.$tipDtText.nodeValue=".",this.$tipArrow=document.createElement("div"),this.$tipArrow.className="tchart--tip-arrow",this.$tip.appendChild(this.$tipArrow),this.$tipLoader=document.createElement("div"),this.$tipLoader.className="tchart--tip-loader",this.$tip.appendChild(this.$tipLoader),this.$tipScrollerWrapper=document.createElement("div"),this.$tipScrollerWrapper.className="tchart--tip-scroller-wrapper",this.$tip.appendChild(this.$tipScrollerWrapper),this.$tipScroller=document.createElement("div"),this.$tipScroller.className="tchart--tip-scroller",this.$tipScrollerWrapper.appendChild(this.$tipScroller),this.$tipScroller.addEventListener("scroll",this.updateTipScrollClasses),this.labels=[],t.data.ys.forEach(s=>{this.labels.push(this.addLabel(s))}),t.graphStyle==="bar"&&t.data.ys.length>1&&(this.allLabel=this.addLabel({label:t.settings.ALL_LABEL,outside:!0})),t.graphStyle==="area"&&(this.pieLabel=this.addLabel({label:"pie",outside:!0})),this.tooltipOnHover=this.isTouch?!1:t.data.tooltipOnHover,t.graphStyle!=="bar"?(this.$line=document.createElement("div"),this.$line.className="tchart--line",t.$parent.appendChild(this.$line),this.$lineFill=document.createElement("div"),this.$lineFill.className="tchart--line-fill",this.$line.appendChild(this.$lineFill),t.graphStyle!=="area"&&(this.points=t.data.ys.map(()=>{const s=document.createElement("span");return s.className="tchart--line-point",this.$line.appendChild(s),s}))):(t.state.barInd=-1,t.state.barO=0),this.tooltipOnHover?(this.$canvas.addEventListener("mousemove",s=>{this.canvasPos=this.canvasPos||ut(this.$canvas),this.dx=s.pageX-this.canvasPos.x,this.dy=s.pageY-this.canvasPos.y;const i=this.opts.state.dims.tip;this.tp=this.getTp(this.dx,this.dy-i.t,this.isTouch),this.tp?this.shown?this.render({isMove:!0}):(delete this.prevXInd,this.toggle(!0),this.render({})):this.toggle(!1)}),this.$canvas.addEventListener("mouseleave",()=>{delete this.canvasPos,this.toggle(!1)}),this.$canvas.addEventListener("click",s=>{this.shown&&this.onTipClick(s)}),this.$tip.style.pointerEvents="none"):(this.drag=new Dt({$el:this.$canvas,onDragStart:s=>{this.canvasPos=ut(this.$canvas),this.dx=s.pageX-this.canvasPos.x,this.dy=s.pageY-this.canvasPos.y;const i=this.opts.state.dims.tip;return this.tp=this.getTp(this.dx,this.dy-i.t,s.isTouch),delete this.prevXInd,clearTimeout(this.showTimeout),this.showTimeout=window.setTimeout(()=>{this.toggle(!!this.tp),this.tp&&this.render()},this.isTouch?100:30),document.body.removeEventListener("click",this.onBodyClick),!this.tp},onDragMove:s=>{if(s.canceled){clearTimeout(this.showTimeout),this.toggle(!1);return}this.canvasPos=this.canvasPos||ut(this.$canvas),this.dx=s.pageX-this.canvasPos.x,this.dy=s.pageY-this.canvasPos.y,this.render({isMove:!0})},onDragEnd:()=>{delete this.canvasPos,this.bodyTimeout=window.setTimeout(()=>{document.body.addEventListener("click",this.onBodyClick)},140)}}),this.$tip.addEventListener("click",this.onTipClick)),this.trackMouse(!0),this.updateColors()}onResize(t){const s=this.opts.state.dims.tip;if(this.$line){const i=this.opts.graphStyle==="area"?25:16;this.$line.style.top=s.t+"px",this.$line.style.height=s.h+"px",this.$lineFill.style.top=i+"px",this.$lineFill.style.bottom=this.opts.settings.PADD[2]+1+"px"}this.render()}abortDetailCallbacks(){this.detailCallbacks&&(this.detailCallbacks.forEach(t=>{t.cancelled=!0}),delete this.detailCallbacks)}updateColors(){const t=this.opts.data.ys;this.labels.forEach((s,i)=>{this.points&&(this.points[i].style.borderColor=this.isDarkMode?t[i].colors_n[0]:t[i].colors_d[0]),s.$value.style.color=this.isDarkMode?t[i].colors_n[2]:t[i].colors_d[2]}),this.allLabel&&(this.allLabel.$value.style.color="var(--tchart-text-color)"),this.$lineFill&&(this.$lineFill.style.backgroundColor=this.opts.settings.COLORS.grid)}setDarkMode(t){this.isDarkMode=t,this.updateColors()}addLabel(t){const s=document.createElement("div");s.className="tchart--tip-row",t.outside?(this.$tip.appendChild(s),s.classList.add("tchart--tip-row__outside")):this.$tipScroller.appendChild(s);const i=document.createElement("span");i.className="tchart--tip-row-label",s.appendChild(i);const a=document.createTextNode("");a.nodeValue=t.label,i.appendChild(a);let e,h;this.opts.graphStyle==="area"&&(h=document.createElement("p"),h.className="tchart--tip-row-per",s.appendChild(h),e=document.createTextNode(""),h.appendChild(e));const n=document.createElement("div");n.className="tchart--tip-row-value",s.appendChild(n);const l=document.createTextNode("");return n.appendChild(l),{$row:s,$value:n,$valueText:l,$label:i,$labelText:a,$per:h,$perText:e}}getTp(t,s,i){if(this.opts.graphStyle==="area"&&this.opts.state.zoomMode){const a=this.opts.state.dims.graph,e=a.w/2,h=a.h/2;return Math.pow((h-s)*(h-s)+(t-e)*(t-e),.5)<=this.opts.settings.PIE_RADIUS?"graph":""}else{const a=this.opts.state.dims.tip;return s<0||s>a.h?"":"graph"}}trackMouse(t,s){this.isTouch||(this.$canvas.addEventListener("mousemove",this.onMouseMove),this.$canvas.addEventListener("mouseleave",this.onMouseLeave))}toggle(t,s){const i=this.opts,a=i.state;if(t&&!this.shown&&(this.$tip.classList.add("tchart--tip__visible"),this.opts.data.hasDetail&&!(this.opts.state.zoomMode||this.opts.state.zoomModeSpecial)?this.$tip.classList.add("tchart--tip__has-zoom"):this.$tip.classList.remove("tchart--tip__has-zoom"),this.$tip.classList.remove("tchart--tip__shiftHide"),this.$line&&this.$line.classList.add("tchart--line__visible"),St("chart-hide-tips",{except:this.opts.chart})),!t&&this.shown){if(delete this.lastCurPieItemInd,i.graphStyle==="area"&&a.zoomMode){const e=[];for(let h=0;h<a.pieAngles.length;h++){const n=a.pieAngles[h];e.push({prop:`pieInd_${n.ind}`,state:i.state,end:0,duration:350,tween:"exp",speed:.2,group:{top:!0}})}i.animator.add(e)}s&&(this.$tip.classList.add("tchart--tip__shiftHide"),this.lastTipTop-=12,this.lastTipLeft=this.lastTipLeft<this.opts.state.dims.tip.w/2?this.lastTipLeft-12:this.lastTipLeft+12,this.$tip.style.transform="translate("+this.lastTipLeft+"px,"+this.lastTipTop+"px)",this.$tip.style.webkitTransform="translate("+this.lastTipLeft+"px,"+this.lastTipTop+"px)"),this.$tip.classList.remove("tchart--tip__visible"),this.$line&&this.$line.classList.remove("tchart--line__visible"),this.abortDetailCallbacks(),this.$tip.classList.remove("tchart--tip__error"),this.$tip.classList.remove("tchart--tip__loading"),this.opts.graphStyle==="bar"&&this.opts.animator.add([{prop:"barInd",state:this.opts.state,end:-1,duration:0,delay:150,tween:"linear",group:{top:!0}},{prop:"barO",state:this.opts.state,end:0,duration:150,tween:"exp",speed:.3,group:{top:!0}}]),document.body.removeEventListener("click",this.onBodyClick)}this.shown=t}renderPieTooltip(t){const s=this.opts,i=s.state,a=this.opts.settings,e=a.PADD[0],h=a.PADD[1],n=a.PADD[2],l=a.PADD[3],d=i.dims.graph,p=i.dims.tip,o=d.w/2,m=d.h/2,r=dt("yTooltipFormatter",s.data,i.zoomMorph);let c=Math.atan2(m-this.dy+d.t,this.dx-o);c=c<0?Math.PI*2+c:c;let u;for(let g=0;g<i.pieAngles.length;g++){const f=i.pieAngles[g];c<=f.st&&c>=f.ed&&(u=f),c-2*Math.PI<=f.st&&c-2*Math.PI>=f.ed&&(u=f)}if(this.lastCurPieItemInd!==u.ind){const g=[];for(let f=0;f<i.pieAngles.length;f++){const T=i.pieAngles[f];g.push({prop:`pieInd_${T.ind}`,state:s.state,end:T===u?1:0,duration:350,tween:"exp",speed:.2,group:{top:!0}})}s.animator.add(g)}this.pieLabel.$row.style.display="block",this.labels.forEach(g=>{g.$row.style.display="none"}),this.pieLabel.$labelText.nodeValue=u.label,this.pieLabel.$valueText.nodeValue=isNaN(u.value)?"n/a":r(u.value),this.pieLabel.$value.style.color=u.color,this.$tip.classList.add("tchart--tip__piemode"),this.$line&&this.$line.classList.add("tchart--line__piemode"),this.tipH=this.$tip.offsetHeight,this.tipW=this.$tip.offsetWidth;const M=20;let w=this.dx-this.tipW/2,y=Math.min(this.dy-M-this.tipH,p.t+p.h-this.tipH-n);y<p.t+e&&(y=p.t+e),w=Math.min(Math.max(w,l/2),p.w-this.tipW-h/2),this.$tip.style.transform="translate("+(w<<0)+"px,"+(y<<0)+"px)",this.$tip.style.webkitTransform="translate("+(w<<0)+"px,"+(y<<0)+"px)",this.lastCurPieItemInd=u.ind,this.updateTipScrollClasses()}render(t={}){if(!this.shown)return;const s=this.opts,i=s.state,a=this.opts.settings,e=a.PADD[0],h=a.PADD[1],n=a.PADD[2],l=a.PADD[3];let d,p,o,m=0;const r=this.opts.state.dims.tip,c=dt("yTooltipFormatter",s.data,i.zoomMorph),u=i.zoomMorph===void 0?0:i.zoomMorph,M=(s.graphStyle==="bar"||s.graphStyle==="step"?this.opts.data.mainPeriodLen:0)*(1-u);if(this.abortDetailCallbacks(),this.$tip.classList.remove("tchart--tip__error"),this.$tip.classList.remove("tchart--tip__loading"),s.graphStyle==="area"&&i.zoomMode){this.renderPieTooltip(t);return}else this.pieLabel&&(this.pieLabel.$row.style.display="none");const w=Math.max(Math.min(this.dx,r.w-1),0),y=i.x1+(i.x2-i.x1+M)*((w-l)/(r.w-h-l)),g=J(s.data.x,y);let f=s.graphStyle==="bar"||s.graphStyle==="step"?Math.floor(g):Math.round(g);if(s.graphStyle!=="bar"&&s.graphStyle!=="step"){const S=(s.data.x[f]-i.x1)/(i.x2-i.x1+M)*(r.w-l-h)+l<<0;S<0&&f++,S>r.w-1&&f--}else(this.opts.state.zoomMode||this.opts.state.zoomModeSpecial)&&(f<s.state.detailInd1&&f++,f>s.state.detailInd2&&f--);if(s.graphStyle==="bar"&&s.animator.add([{prop:"barInd",state:s.state,end:f,duration:0,tween:"linear",group:{top:!0}},{prop:"barO",state:this.opts.state,end:1,duration:150,tween:"exp",speed:.3,group:{top:!0}}]),this.prevXInd!==f||!t.isMove){this.$tip.classList.remove("tchart--tip__piemode"),this.$line&&this.$line.classList.remove("tchart--line__piemode"),this.labels.forEach((x,A)=>{const Y=s.state[`e_${A}`]&&!isNaN(s.data.ys[A].y[f])?"block":"none";x.$row.style.display=Y,this.points&&(this.points[A].style.display=Y),m+=Y==="block"?1:0}),this.itemsVisible=m,this.allLabel&&(this.allLabel.$row.style.display=m>1?"block":"none"),this.itemsVisible?(this.$tip.classList.remove("tchart--tip__has_no_items"),this.$line&&this.$line.classList.remove("tchart--line__has_no_items")):(this.$tip.classList.add("tchart--tip__has_no_items"),this.$line&&this.$line.classList.add("tchart--line__has_no_items"));let S=0;s.graphStyle==="step"&&(this.opts.state.zoomMode?S=s.data.detailPeriodLen:S=s.data.mainPeriodLen);const L=(s.data.x[f]-i.x1+S/2)/(i.x2-i.x1+M)*(r.w-l-h)+l<<0;this.$line&&(this.$line.style.transform="translateX("+L+"px)"),this.$line&&(this.$line.style.webkitTransform="translateX("+L+"px)"),this.$tipDtText.nodeValue=s.data.dates[f];let _=0;if(s.data.ys.forEach((x,A)=>{if(s.state[`e_${A}`]&&!isNaN(x.y[f])&&(this.labels[A].$valueText.nodeValue=c(x.y[f]),_+=x.y[f]||0,this.points)){d=this.points[A],s.pairY?(p=i[`y1_${A}`],o=i[`y2_${A}`]):(p=i.y1,o=i.y2);const Y=(x.y[f]-p)/(o-p);d.style.transform="translateY("+(r.h-Y*(r.h-e-n)-n<<0)+"px)",d.style.webkitTransform="translateY("+(r.h-Y*(r.h-e-n)-n<<0)+"px)"}}),this.allLabel&&(this.allLabel.$valueText.nodeValue=c(_)),!t.isMove){this.maxLabelWidth=0,this.maxValueWidth=0,this.maxPercentageWidth=0,this.maxDateWidth=0;const x=window.getComputedStyle(this.$tip);this.rowPaddings=parseInt(x.getPropertyValue("padding-left"),10)+parseInt(x.getPropertyValue("padding-right"),10)}s.graphStyle==="area"&&this.fillPercentages(f,_),this.labels.forEach((x,A)=>{if(s.state[`e_${A}`]&&!isNaN(s.data.ys[A].y[f])){const Y=x.$label.offsetWidth;Y>this.maxLabelWidth&&(this.maxLabelWidth=Y);const q=x.$value.offsetWidth;q>this.maxValueWidth&&(this.maxValueWidth=q)}});let b=this.rowPaddings+this.maxLabelWidth+20+this.maxValueWidth;b+=s.graphStyle==="area"?this.maxPercentageWidth:0;const I=this.rowPaddings+this.$tipDt.offsetWidth+20;I>this.maxDateWidth&&(this.maxDateWidth=I),b=Math.max(b,this.maxDateWidth),this.$tip.style.width=b+"px",this.tipH=this.$tip.offsetHeight,this.tipW=this.$tip.offsetWidth}let T=this.itemsVisible<=2?"center":"side";const R=20;let $,D;T==="center"&&($=this.dx-this.tipW/2,D=Math.min(this.dy-R-this.tipH,r.t+r.h-this.tipH-n),D<r.t+e&&(T="side")),T==="side"&&(this.dx>r.w/2?$=this.dx-this.tipW-R:$=this.dx+R,D=Math.min(Math.max(this.dy-this.tipH/2,r.t+e),r.t+r.h-this.tipH-n)),$=Math.min(Math.max($,l/2),r.w-this.tipW-h/2),this.$tip.style.transform="translate("+($<<0)+"px,"+(D<<0)+"px)",this.$tip.style.webkitTransform="translate("+($<<0)+"px,"+(D<<0)+"px)",this.lastTipLeft=$<<0,this.lastTipTop=D<<0,this.prevXInd=f,this.updateTipScrollClasses()}fillPercentages(t,s){const i=this.opts,a=[];let e=2;i.data.ys.forEach((h,n)=>{i.state[`e_${n}`]&&(a[n]=Math.max(Math.round(100*h.y[t]/s),0),(isNaN(h.y[t])||s===0)&&(a[n]=0),a[n]===100&&(e=3))}),i.data.ys.forEach((h,n)=>{if(i.state[`e_${n}`]){const l=e*8+17;this.labels[n].$label.style.transform="translateX("+l+"px)",this.labels[n].$label.style.webkitTransform="translateX("+l+"px)",this.labels[n].$perText.nodeValue=a[n]+"%",this.labels[n].$per.style.width=l-7+"px",l>this.maxPercentageWidth&&(this.maxPercentageWidth=l)}})}}class wt{constructor(t){this.onResize=()=>{const d=Math.min(window.devicePixelRatio||1,2);if(this.ww===window.innerWidth&&d===this.settings.dpi)return;if(this.settings.dpi=d,this.ww=window.innerWidth,this.data.sideLegend){this.$switchers.classList.remove("tchart--switchers__no-space");const r=this.getGraphWidth(!0);r.hasSpaceForLegend?this.$graph.style.width=r.width+"px":(this.$switchers.classList.add("tchart--switchers__no-space"),this.$graph.style.width=r.width+"px")}const p=this.$graph.getBoundingClientRect(),o=this.settings,m=p.height-o.DATES_HEIGHT-o.MINI_GRAPH_HEIGHT-o.MINI_GRAPH_TOP-o.MINI_GRAPH_BOTTOM;this.state.dims={composer:{w:p.width,h:p.height,l:0,t:0},graph:{w:p.width,h:m,l:0,t:o.DATES_HEIGHT},axisYLeft:{w:o.Y_LABELS_WIDTH,h:m,l:o.PADD[3],t:o.DATES_HEIGHT},axisYRight:{w:o.Y_LABELS_WIDTH,h:m,l:p.width-o.PADD[1]-o.Y_LABELS_WIDTH,t:o.DATES_HEIGHT},axisYLines:{w:p.width-o.PADD[1]-o.PADD[3],h:m,l:o.PADD[3],t:o.DATES_HEIGHT},fadeTop:{w:p.width,h:o.FADE_HEIGHT,l:0,t:o.DATES_HEIGHT},fadeBottom:{w:p.width,h:o.FADE_HEIGHT,l:0,t:o.DATES_HEIGHT+m-o.FADE_HEIGHT},axisX:{w:p.width,h:o.X_LABELS_HEIGHT,l:0,t:o.DATES_HEIGHT+m-o.X_LABELS_HEIGHT},dates:{w:o.DATES_WIDTH,h:o.DATES_HEIGHT,l:this.opts.settings.DATES_SIDE==="right"?p.width-o.DATES_WIDTH-o.PADD[1]:o.PADD[1],t:0},mini:{w:p.width-o.PADD[1]-o.PADD[3],h:o.MINI_GRAPH_HEIGHT,l:o.PADD[3],t:o.DATES_HEIGHT+m+o.MINI_GRAPH_TOP},handle:{w:p.width-o.PADD[1]-o.PADD[3],h:o.MINI_GRAPH_HEIGHT+2,l:o.PADD[3],t:o.DATES_HEIGHT+m+o.MINI_GRAPH_TOP-1},tip:{w:p.width,h:m,l:0,t:o.DATES_HEIGHT}},this.graph.onResize(),this.axisY.onResize(),this.fade.onResize(),this.axisX.onResize(),this.mini.onResize(),this.handle.onResize(),this.tip.onResize(),this.composer.onResize()},this.onHandleMove=(d,p,o,m)=>{let r=this.state.zoomMode;if(this.updateSpeed(),r=!1,r){const M=this.data.mainPeriodLen;d=Math.round(d/M)*M,p=Math.round(p/M)*M,d=Math.min(Math.max(d,this.state.xg1),this.state.xg2-M),p=Math.min(Math.max(p,this.state.xg1+M),this.state.xg2),p<=d&&(p=d+M);const w=this.animator.get("x1"),y=this.animator.get("x2"),g=w?w.end:this.state.x1,f=y?y.end:this.state.x2;if(d===g&&p===f)return}const c=[],u=this.getYMinMax(d,p,!1,!0);this.axisX.setAnimation(r||o!=="both"),this.axisY.setAnimation(!0),this.axisY.setForceUpdate(!1),m&&St("chart-hide-tips",{except:null}),c.push({prop:"x1",state:this.state,end:d,fixed:!0,duration:r?250:0,group:{top:!0,bottom:!0}}),c.push({prop:"x2",state:this.state,end:p,fixed:!0,duration:r?250:0,group:{top:!0,bottom:!0}});for(let M=0;M<this.data.ys.length;M++)(this.graphStyle==="line"||this.graphStyle==="step")&&c.push({prop:this.pairY?`y1_${M}`:"y1",state:this.state,end:this.pairY?u.min[M]:u.min,duration:500,fixed:!0,tween:"exp",speed:.25,group:{top:!0}}),this.graphStyle!=="area"&&c.push({prop:this.pairY?`y2_${M}`:"y2",state:this.state,end:this.pairY?u.max[M]:u.max,duration:500,fixed:!0,tween:"exp",speed:.25,group:{top:!0}});this.animator.add(c)},this.onSwitcherEnter=d=>{clearTimeout(this.switcherLeaveTimeout);const p=[];for(let o=0;o<this.data.ys.length;o++)p.push({prop:`f_${o}`,state:this.state,end:d===o?1:0,duration:300,tween:"exp",speed:.15,group:{top:!0,bottom:!0}}),p.push({prop:`pieInd_${o}`,state:this.state,end:d===o?1:0,duration:300,tween:"exp",speed:.15,group:{top:!0,bottom:!0}});this.animator.add(p)},this.onSwitcherLeave=d=>{clearTimeout(this.switcherLeaveTimeout),this.switcherLeaveTimeout=window.setTimeout(()=>{const p=[];for(let o=0;o<this.data.ys.length;o++)p.push({prop:`f_${o}`,state:this.state,end:1,duration:300,tween:"exp",speed:.15,group:{top:!0,bottom:!0}}),p.push({prop:`pieInd_${o}`,state:this.state,end:0,duration:300,tween:"exp",speed:.15,group:{top:!0,bottom:!0}});this.animator.add(p)},300)},this.onSwitcherChange=(d,p)=>{var o,m,r,c=[],u,M=[],w=[],y,g;if(this.updateSpeed(),typeof d!="boolean")for(y=!0,p=d,g=!0,r=0;r<this.data.ys.length;r++)g=g&&(r===p?this.state[`e_${r}`]:!this.state[`e_${r}`]);var f=0;for(r=0;r<this.data.ys.length;r++)u=r===p,w[r]=this.state[`e_${r}`],y?this.state[`e_${r}`]=u:u&&(this.state[`e_${r}`]=!!d),g&&y&&(this.state[`e_${r}`]=!0),M[r]=this.state[`e_${r}`],M[r]&&(f=Math.max(f,this.data.ys[r].y.length));var T=this.reduceGlobalRange({});for(T.isReduced?(c.push({prop:"x1",state:this.state,end:T.x1,duration:333,group:{top:!0,bottom:!0}}),c.push({prop:"x2",state:this.state,end:T.x2,duration:333,group:{top:!0,bottom:!0}}),c.push({prop:"xg1",state:this.state,end:T.xg1,duration:333,group:{top:!0,bottom:!0}}),c.push({prop:"xg2",state:this.state,end:T.xg2,duration:333,group:{top:!0,bottom:!0}}),this.state.xg1Ind=T.xg1Ind,this.state.xg2Ind=T.xg2Ind,o=this.getYMinMax(T.x1,T.x2,!1,!0),m=this.getYMinMax(T.xg1,T.xg2,!0)):(o=this.getYMinMax(this.state.x1,this.state.x2,!1,!0),m=this.getYMinMax(this.state.xg1,this.state.xg2,!0)),St("chart-hide-tips",{except:null}),this.axisY.setForceUpdate(!0),this.axisY.setAnimation(!0),this.state.activeColumnsCount=0,r=0;r<M.length;r++)M[r]&&this.state.activeColumnsCount++,w[r]!==M[r]&&(c.push({prop:`o_${r}`,state:this.state,end:M[r]?1:0,duration:300,group:{top:!0}}),c.push({prop:`om_${r}`,state:this.state,end:M[r]?1:0,duration:this.graphStyle==="line"||this.graphStyle==="step"?166:300,delay:M[r]&&this.graphStyle==="line"||this.graphStyle==="step"?200:0,tween:"linear",group:{bottom:!0}}));for(r=0;r<(this.pairY?M.length:1);r++)(this.graphStyle==="line"||this.graphStyle==="step")&&c.push({prop:this.pairY?`y1_${r}`:"y1",state:this.state,end:this.pairY?o.min[r]:o.min,duration:this.pairY?0:333,group:{top:!0}}),this.graphStyle!=="area"&&c.push({prop:this.pairY?`y2_${r}`:"y2",state:this.state,end:this.pairY?o.max[r]:o.max,duration:this.pairY?0:333,group:{top:!0}}),(this.graphStyle==="line"||this.graphStyle==="step")&&c.push({prop:this.pairY?`y1m_${r}`:"y1m",state:this.state,end:this.pairY?m.min[r]:m.min,duration:this.pairY?0:316,group:{bottom:!0}}),this.graphStyle!=="area"&&c.push({prop:this.pairY?`y2m_${r}`:"y2m",state:this.state,end:this.pairY?m.max[r]:m.max,duration:this.pairY?0:316,group:{bottom:!0}});this.state.y1m_hidd=this.state.y1m,this.state.y2m_hidd=this.state.y2m,this.state.y1m_show=m.min,this.state.y2m_show=m.max,this.switchers.render(M),this.animator.add(c)},this.toggleZoom=(d,p,o)=>{if(o&&this.specialZoomTransition===void 0&&(o.columns.length!==this.data.ys.length+1&&(this.specialZoomTransition=!0),this.specialZoomTransition||o.columns.forEach(_=>{const b=_[0],I=o.types[b],x=o.names[b],A=this.data.yIds[b];if(A!==void 0){const Y=this.data.ys[A].tp,q=this.data.ys[A].label;(Y!==I||q!==x)&&(this.specialZoomTransition=!0)}else b!=="x"&&(this.specialZoomTransition=!0)}),this.specialZoomTransition===void 0&&(this.specialZoomTransition=!1)),this.specialZoomTransition&&(this.data.master=!0,this.$el.classList.add("tchart__master"),!this.slaveChart)){const _=JSON.parse(JSON.stringify(o));_.yTickFormatter=o.yTickFormatter,_.yTooltipFormatter=o.yTooltipFormatter,_.xTickFormatter=o.xTickFormatter,_.xTooltipFormatter=o.xTooltipFormatter,_.xRangeFormatter=o.xRangeFormatter,_.sideLegend=this.data.sideLegend,_.getLabelDate=this.data.getLabelDate,_.getLabelTime=this.data.getLabelTime,this.slaveChart=new wt({container:this.opts.container,slave:!0,data:_}),this.slaveChart.setDarkMode(this.darkMode)}if(o&&!o.details&&(o.details={y:[],names:[]},o.columns.forEach(_=>{const b=_.shift(),I=o.types[b],x=o.names[b];I==="x"?o.details.x=_:this.specialZoomTransition?(o.details.y.push(_),o.details.names.push(x)):o.details.y[this.data.yIds[b]]=_})),o&&(o.subchart={show:o.subchart&&o.subchart.show!==void 0?o.subchart.show:!0,defaultZoom:o.subchart&&o.subchart.defaultZoom},o.details.subchart=o.subchart,o.details.hidden=o.hidden||[]),this.specialZoomTransition){this.toggleZoomSpecial(d,p,o&&o.details);return}const m=o&&o.details;var r,c,u=[];if(this.state.zoomMode===d)return;if(d){if(this.state.zoomMode=!0,this.state.zoomDir=1,this.$h1.classList.add("tchart--header__hidden"),this.$zoom.classList.add("tchart--zoom__visible"),this.zoomEnterSpeed=this.updateSpeed(),o&&(this.data.details={yTickFormatter:o.yTickFormatter,yTooltipFormatter:o.yTooltipFormatter,xTickFormatter:o.xTickFormatter,xTooltipFormatter:o.xTooltipFormatter,xRangeFormatter:o.xRangeFormatter,subchart:o.subchart,hidden:o.hidden||[]}),!this.hasSavedData){this.data.saved={},this.data.saved.x=this.data.x.slice(),this.data.saved.dates=this.data.dates.slice(),this.data.saved.datesShort=this.data.datesShort.slice(),this.data.saved.datesRange=this.data.datesRange.slice(),this.data.saved.y=[];for(let _=0;_<this.data.ys.length;_++)this.data.saved.y[_]=this.data.ys[_].y.slice();this.hasSavedData=!0}this.data.details&&this.data.details.subchart&&(this.data.details.subchart.show?this.$el.classList.remove("tchart__no-subchart"):this.$el.classList.add("tchart__no-subchart")),this.state.zoomSaved={x1:this.state.x1,x2:this.state.x2,xg1:this.state.xg1,xg2:this.state.xg2,xgMin:this.state.xgMin,xgMax:this.state.xgMax};var M=this.data.mainPeriodLen,y=p,g=p+M;if(this.data.details)var w=this.getDefaultZoom({x1:y,x2:g,xg1:m.x[0],xg2:m.x[m.x.length-1],default:this.data.details.subchart.defaultZoom}),y=w.x1,g=w.x2;var f,T;if(this.graphStyle!=="area")this.data.detailPeriodLen=m.x[1]-m.x[0],f=m.x[0],T=m.x[m.x.length-1];else{this.data.detailPeriodLen=M;var R=this.data.pieZoomRange;f=y-(R-M)/2,T=f+R,g=y+Math.round(R/7/M)*M,f<this.data.x[0]?(f=this.data.x[0],T=f+R,T>this.data.x[this.data.x.length-1]&&(T=this.data.x[this.data.x.length-1]+M)):T>this.data.x[this.data.x.length-1]&&(T=this.data.x[this.data.x.length-1]+M,f=T-R,f<this.data.x[0]&&(f=this.data.x[0]))}f=Math.round(f/M)*M,T=Math.round(T/M)*M,this.graphStyle!=="area"&&this.insertDetails(f,T,m),this.state.xgMin=f,this.state.xgMax=T}else this.updateSpeed(this.zoomEnterSpeed/(this.graphStyle==="area"?2:1)),this.$h1.classList.remove("tchart--header__hidden"),this.$zoom.classList.remove("tchart--zoom__visible"),this.data.details&&(this.data.subchart.show?this.$el.classList.remove("tchart__no-subchart"):this.$el.classList.add("tchart__no-subchart")),this.state.zoomDir=-1,y=this.state.zoomSaved.x1,g=this.state.zoomSaved.x2,f=this.state.zoomSaved.xg1,T=this.state.zoomSaved.xg2,this.state.xgMin=this.state.zoomSaved.xgMin,this.state.xgMax=this.state.zoomSaved.xgMax;this.axisY.setForceUpdate(!0),this.axisY.setAnimation(!0),this.axisX.setAnimation(!0);let $=450,D=0,S=0;this.graphStyle==="area"&&($=350,d?S=$*.95:D=$*.95);const L=this.reduceGlobalRange({x1:y,x2:g,xg1:f,xg2:T,useSaved:!d});L.isReduced&&(y=L.x1,g=L.x2,f=L.xg1,T=L.xg2),this.state.xg1Ind=Math.floor(J(d?this.data.x:this.data.saved.x,f)),this.state.xg2Ind=Math.ceil(J(d?this.data.x:this.data.saved.x,T)),r=this.getYMinMax(y,g,!1,!0,!d),c=this.getYMinMax(f,T,!0,!1,!d),document.body.style.pointerEvents="none",setTimeout(()=>{d||(this.state.zoomMode=!1,this.graphStyle!=="area"&&this.revertDetails()),document.body.style.pointerEvents="",this.composer.render({top:!0,bottom:!0})},$+20+(this.graphStyle==="area"?$*.9:0)),this.state.zoomMorph=d?0:1,u.push({prop:"zoomMorph",state:this.state,end:d?1:0,duration:$,delay:S,group:{top:!0,bottom:!0}}),u.push({prop:"x1",state:this.state,end:y,delay:D,duration:$,group:{top:!0,bottom:!0}}),u.push({prop:"x2",state:this.state,end:g,delay:D,duration:$,group:{top:!0,bottom:!0}}),u.push({prop:"xg1",state:this.state,end:f,delay:D,duration:$,group:{top:!0,bottom:!0}}),u.push({prop:"xg2",state:this.state,end:T,delay:D,duration:$,group:{top:!0,bottom:!0}});for(let _=0;_<(this.pairY?this.data.ys.length:1);_++)(this.graphStyle==="line"||this.graphStyle==="step")&&u.push({prop:this.pairY?`y1_${_}`:"y1",state:this.state,end:this.pairY?r.min[_]:r.min,delay:D,duration:$,group:{top:!0}}),this.graphStyle!=="area"&&u.push({prop:this.pairY?`y2_${_}`:"y2",state:this.state,end:this.pairY?r.max[_]:r.max,delay:D,duration:$,group:{top:!0}}),(this.graphStyle==="line"||this.graphStyle==="step")&&u.push({prop:this.pairY?`y1m_${_}`:"y1m",state:this.state,end:this.pairY?c.min[_]:c.min,delay:D,duration:$,group:{bottom:!0}}),this.graphStyle!=="area"&&u.push({prop:this.pairY?`y2m_${_}`:"y2m",state:this.state,end:this.pairY?c.max[_]:c.max,delay:D,duration:$,group:{bottom:!0}});this.animator.add(u)},this.state={},this.state.masterVisibility=1,this.state.slaveVisibility=0,this.specialZoomTransition=void 0;const s=(!!window.ActiveXObject&&+/msie\s(\d+)/i.exec(navigator.userAgent)[1]||NaN-0)<11,i=navigator.userAgent.indexOf("Trident/")!==-1&&(navigator.userAgent.indexOf("rv:")!==-1||navigator.appName.indexOf("Netscape")!==-1),a={background:"#FFFFFF",backgroundRgb:[255,255,255],text:"#000000",dates:"#000",grid:"rgba(24, 45, 59, 0.1)",axis:{x:"rgba(37,37,41,0.5)",y:"rgba(37,37,41,0.5)"},barsSelectionBackground:"rgba(255, 255, 255, 0.5)",miniMask:"rgba(226, 238, 249, 0.6)",miniFrame:"#C0D1E1"},e={background:"#242F3E",backgroundRgb:[36,47,62],text:"#FFFFFF",dates:"#fff",grid:"rgba(255, 255, 255, 0.1)",axis:{x:"rgba(163,177,194,0.6)",y:"rgba(236,242,248,0.5)"},barsSelectionBackground:"rgba(36, 47, 62, 0.5)",miniMask:"rgba(48, 66, 89, 0.6)",miniFrame:"#56626D"},h=!!document.documentElement.classList.contains("dark");this.settings={isIE:s||i,isEdge:/Edge\/\d./i.test(navigator.userAgent),dpi:Math.min(window.devicePixelRatio||1,2),darkMode:h,ALL_LABEL:"All",Y_AXIS_RANGE:5.3,PADD:[20,16,20,16],PADD_MINI:[2,0,2,0],PADD_MINI_BAR:[0,0,0,0],PADD_MINI_AREA:[0,0,0,0],Y_LABELS_WIDTH:50,X_LABELS_HEIGHT:12,DATES_HEIGHT:18,DATES_WIDTH:300,DATES_SIDE:"right",DATES_WEIGHT:"bold",ZOOM_TEXT:"Zoom Out",MINI_GRAPH_HEIGHT:40,MINI_GRAPH_TOP:14,MINI_GRAPH_BOTTOM:2,FADE_HEIGHT:16,PIE_RADIUS:130,FONT:{family:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif',bold:"bold",normal:"normal"},COLORS:h?e:a,...t.settings||{}},this.data={caption:t.data.title,detailsFunc:t.data.x_on_zoom,hasDetail:!!t.data.x_on_zoom,slave:t.slave,yTickFormatter:t.data.yTickFormatter,yTooltipFormatter:t.data.yTooltipFormatter,yMinStep:t.data.yMinStep,xTickFormatter:t.data.xTickFormatter,xTooltipFormatter:t.data.xTooltipFormatter,xRangeFormatter:t.data.xRangeFormatter,strokeWidth:t.data.strokeWidth||"auto",hidden:t.data.hidden||[],tooltipOnHover:!!t.data.tooltipOnHover,forceLegend:t.data.forceLegend,sideLegend:t.data.sideLegend||!1,pieZoomRange:t.data.pieZoomRange||7*86400*1e3,pieLabelsPercentages:{outboard:t.data.pieLabelsPercentages&&t.data.pieLabelsPercentages.outboard!==void 0?t.data.pieLabelsPercentages.outboard:5,hoverOnly:t.data.pieLabelsPercentages&&t.data.pieLabelsPercentages.hoverOnly!==void 0?t.data.pieLabelsPercentages.hoverOnly:2},subchart:{show:t.data.subchart&&t.data.subchart.show!==void 0?t.data.subchart.show:!0,defaultZoom:t.data.subchart&&t.data.subchart.defaultZoom},getLabelDate:t.data.getLabelDate||Xt,getLabelTime:t.data.getLabelTime||Gt},t.data.y_scaled&&(this.pairY=!0),this.graphStyle="line";const n=this.settings;t.data.columns.forEach(d=>{const p=d.shift(),o=t.data.types[p];if(o==="x"){this.data.x=d,this.state.xCount=d.length,this.state.x1=d[d.length*.75<<0],this.state.x2=d[d.length-1],this.state.xg1=d[0],this.state.xg2=d[d.length-1],this.state.xg1Ind=0,this.state.xg2Ind=d.length-1,this.state.xMainMin=d[0],this.state.xMainMax=d[this.state.xg2Ind],this.state.xgMin=d[0],this.state.xgMax=d[this.state.xg2Ind];const m=this.getDefaultZoom({x1:this.state.x1,x2:this.state.x2,xg1:this.state.xg1,xg2:this.state.xg2,default:this.data.subchart.defaultZoom});this.state.x1=m.x1,this.state.x2=m.x2,this.data.mainPeriodLen=this.data.x[1]-this.data.x[0],this.data.detailPeriodLen=this.data.mainPeriodLen,this.data.dates=[],this.data.datesShort=[],this.data.datesRange=[];const r=dt("xTooltipFormatter",this.data,0),c=dt("xTickFormatter",this.data,0),u=this.data.subchart.show?dt("xRangeFormatter",this.data,0):void 0;let M=0;d.forEach((w,y)=>{this.data.dates[y]=r(w,!1),this.data.datesShort[y]=c(w,!1),u&&(this.data.datesRange[y]=u(w,!1)),this.data.datesShort[y].length>M&&(M=this.data.datesShort[y].length)}),this.data.maxXTickLength=M}else{this.data.ys=this.data.ys||[],this.data.yIds=this.data.yIds||{};const m=t.data.colors[p];this.data.ys.push({colors_d:[m,m,m],colors_n:[m,m,m],label:t.data.names[p],y:d,tp:o,id:p});const r=this.data.ys.length-1,c=this.data.hidden.indexOf(p)===-1;this.data.yIds[p]=r,this.state[`e_${r}`]=c,this.state[`o_${r}`]=c?1:0,this.state[`om_${r}`]=c?1:0,this.state[`pieInd_${r}`]=0,this.state[`f_${r}`]=1,this.graphStyle=o}}),this.state.activeColumnsCount=this.data.ys.length,this.updateSpeed(),this.graphStyle==="area"&&(n.Y_AXIS_RANGE=4.06,this.data.hasDetail=!0);const l=this.reduceGlobalRange({});l.isReduced&&(this.state.x1=l.x1,this.state.x2=l.x2,this.state.xg1=l.xg1,this.state.xg2=l.xg2,this.state.xg1Ind=l.xg1Ind,this.state.xg2Ind=l.xg2Ind),this.createDOM(t.container),window.addEventListener("resize",this.onResize),document.addEventListener("darkmode",()=>{this.setDarkMode(!this.darkMode)},!1),document.addEventListener("chart-hide-tips",d=>{d.detail.except!==this&&this.tip.toggle(!1)},!1),this.opts=t,this.onResize(),this.darkMode&&this.setDarkMode(this.darkMode),window.matchMedia("(-webkit-min-device-pixel-ratio: 1), (min-resolution: 96dpi)").addListener(this.onResize),window.matchMedia("(-webkit-min-device-pixel-ratio: 1.5), (min-resolution: 144dpi)").addListener(this.onResize),window.matchMedia("(-webkit-min-device-pixel-ratio: 2), (min-resolution: 192dpi)").addListener(this.onResize),window.matchMedia("(-webkit-min-device-pixel-ratio: 3), (min-resolution: 288dpi)").addListener(this.onResize)}static render(t){const s=document.createElement("div");s.className="tchart--wrapper",t.container.appendChild(s),t.container=s;const i=new wt(t);return i.$wrapper=s,i}get darkMode(){return this.settings.darkMode}reduceGlobalRange(t){let s=t.x1===void 0?this.state.x1:t.x1,i=t.x2===void 0?this.state.x2:t.x2;const a=t.xg1===void 0?this.state.xg1:t.xg1,e=t.xg2===void 0?this.state.xg2:t.xg2,h=t.useSaved?this.data.saved.x:this.data.x,n=Math.floor(J(h,this.state.xgMin)),l=Math.ceil(J(h,this.state.xgMax));let d=l,p=n,o=this.state.zoomMode?this.graphStyle==="bar"||this.graphStyle==="step"?1:2:0;if(this.graphStyle==="area"&&(o=0),this.data.ys.forEach((c,u)=>{var M=t.useSaved?this.data.saved.y[u]:c.y;if(this.state[`e_${u}`])for(let w=n;w<=l-o;++w)M[w]!==void 0&&(d=Math.min(d,w),p=Math.max(p,w))}),p+o===l&&(p=l-Math.max(o-1,0)),d>=p)return{isReduced:!1};const m=h[d],r=h[p];return a===m&&e===r?{isReduced:!1}:(i>r?(s=r-(i-s),i=r,s<m&&(s=m)):s<m&&(i=m+(i-s),s=m,i>r&&(i=r)),{isReduced:!0,x1:s,x2:i,xg1:m,xg2:r,xg1Ind:d,xg2Ind:p})}getDefaultZoom(t){if(!t.default)return{x1:t.x1,x2:t.x2};const s={};return s.x1=t.default[0],s.x2=t.default[1],s.x1=Math.max(s.x1,t.xg1),s.x2=Math.min(s.x2,t.xg2),s.x1>=s.x2&&(s.x1=t.xg1,s.x2=t.xg2),s}updateSpeed(t){const s=this.state.activeColumnsCount*this.state.xCount*Math.pow((this.state.x2-this.state.x1)/(this.state.xMainMax-this.state.xMainMin),.5),i=this.state.deviceSpeed*s/16.66<<0;let a=Math.max(1-.25*i,0);return a=Math.pow(a,.85),this.state.deviceSpeed===void 0&&(t=1),t=1,this.state.speed=t===void 0?a:t,this.state.speed}getYMinMax(t,s,i,a,e){if(this.graphStyle==="area")return{min:0,max:102};const h=this.state.dims?this.state.dims.graph.w:this.getGraphWidth(this.data.sideLegend).width;let n=Number.MAX_VALUE,l=-Number.MAX_VALUE;const d=(s-t)/h;let p=J(e?this.data.saved.x:this.data.x,t-d*this.settings.PADD[3]),o=J(e?this.data.saved.x:this.data.x,s+d*this.settings.PADD[1]);const m=this.data.yMinStep||1,r=[],c=[],u=this.settings,M=this.state;let w,y;!e&&this.state.zoomMode?(p=Math.max(p,this.state.detailInd1),o=Math.min(o,this.state.detailInd2)):(p=Math.max(p,0),o=Math.min(o,this.data.x.length-1));const g=Math.floor(p),f=Math.ceil(p),T=Math.floor(o),R=Math.ceil(o),$=(D,S,L,_)=>{let b;return D===Number.MAX_VALUE?i?L===void 0?(D=M.y1m,S=M.y2m):(D=M[`y1m_${L}`],S=M[`y2m_${L}`]):L===void 0?(D=M.y1,S=M.y2):(D=M[`y1_${L}`],S=M[`y2_${L}`]):(this.graphStyle==="bar"&&(D=0),D=Math.floor(D),S=Math.ceil(S),a&&(b=Kt(D,S,u.Y_AXIS_RANGE),D=b.yMin,S=b.yMax,Math.abs(D-S)<u.Y_AXIS_RANGE*m&&(S=D+Math.floor(u.Y_AXIS_RANGE*m)))),Math.abs(D-S)<.1&&S++,{min:D,max:S,range:b}};if((this.graphStyle==="line"||this.graphStyle==="step")&&this.data.ys.forEach((D,S)=>{const L=e?this.data.saved.y[S]:D.y,_=this.graphStyle==="step"?g:f,b=this.graphStyle==="step"?R:T;if(M[`e_${S}`]||S===0&&this.pairY){let I;for(let x=_;x<=b;x++)I=L[x],I!==void 0&&(I<n&&(n=I),I>l&&(l=I));this.graphStyle==="line"&&(L[g]!==void 0&&L[f]!==void 0&&(w=L[g]+(p-g)*(L[f]-L[g]),w<n&&(n=w),w>l&&(l=w)),L[T]!==void 0&&L[R]!==void 0&&(y=L[T]+(o-T)*(L[R]-L[T]),y<n&&(n=y),y>l&&(l=y)))}if(this.pairY){const I=$(n,l,S);r[S]=I.min,c[S]=I.max,n=Number.MAX_VALUE,l=-Number.MAX_VALUE}}),this.graphStyle==="bar"){const D=[];for(let L=0;L<this.data.ys.length;L++)M[`e_${L}`]&&D.push(L);const S=D.length;for(let L=g;L<=R;L++){let _=0;for(let b=0;b<S;b++)_+=(e?this.data.saved.y[D[b]][L]:this.data.ys[D[b]].y[L])||0;_>l&&(l=_)}n=0}if(this.pairY)return isNaN(r[0])&&(r[0]=r[1]),isNaN(r[1])&&(r[1]=r[0]),isNaN(c[0])&&(c[0]=c[1]),isNaN(c[1])&&(c[1]=c[0]),{min:r,max:c};{const D=$(n,l);return{min:D.min,max:D.max}}}setDarkMode(t,s){this.settings.darkMode=t,s&&(this.settings.COLORS=s),this.graph.setDarkMode(t),this.axisY.setDarkMode(t),this.fade.setDarkMode(t),this.axisX.setDarkMode(t),this.mini.setDarkMode(t),this.handle.setDarkMode(t),this.tip.setDarkMode(t),this.switchers.setDarkMode(t),this.composer.setDarkMode(t)}getGraphWidth(t){const s=this.$el.getBoundingClientRect();if(t){const i=this.$switchers.getBoundingClientRect();return s.width-i.width>=500?{hasSpaceForLegend:!0,width:Math.max(s.width-i.width,1)}:{hasSpaceForLegend:!1,width:s.width}}else return{width:s.width}}createDOM(t){const s=this.settings;this.$el=document.createElement("div"),this.$el.className="tchart",this.data.subchart.show||this.$el.classList.add("tchart__no-subchart"),this.data.slave&&this.$el.classList.add("tchart__slave"),this.$h1=document.createElement("h1"),this.$h1.className="tchart--header",this.$h1.textContent=this.data.caption,this.$el.appendChild(this.$h1),this.$zoom=document.createElement("div"),this.$zoom.className="tchart--zoom",this.$el.appendChild(this.$zoom);const i=document.createElement("div");i.className="tchart--zoom-icon",this.$zoom.appendChild(i);const a=document.createElement("span");a.textContent=this.settings.ZOOM_TEXT,this.$zoom.appendChild(a),this.$zoom.addEventListener("click",()=>{this.toggleZoom(!1)}),this.$graph=document.createElement("div"),this.$graph.className="tchart--graph",this.$el.appendChild(this.$graph),this.$switchers=document.createElement("div"),this.$switchers.className="tchart--switchers",this.data.sideLegend&&this.$switchers.classList.add("tchart--switchers__side-legend"),this.$el.appendChild(this.$switchers),t.appendChild(this.$el);const e=this.getYMinMax(this.state.x1,this.state.x2,!1,!0),h=this.getYMinMax(this.state.xg1,this.state.xg2,!0);if(this.pairY)for(let l=0;l<this.data.ys.length;l++)this.state[`y1_${l}`]=e.min[l],this.state[`y2_${l}`]=e.max[l],this.state[`y1m_${l}`]=h.min[l],this.state[`y2m_${l}`]=h.max[l];else this.state.y1=e.min,this.state.y2=e.max,this.state.y1m=h.min,this.state.y2m=h.max;this.composer=new is({$parent:this.$graph,settings:s,chart:this,state:this.state,data:this.data,graphStyle:this.graphStyle}),this.animator=new Yt({state:this.state,composer:this.composer});const n={line:Rt,step:Rt,bar:es,area:Qt};[["graph",n[this.graphStyle],this.$graph],["axisX",ts,this.$graph],["fade",as,this.$graph],["axisY",ss,this.$graph],["tip",ns,this.$graph,{onClick:this.toggleZoom}],["mini",n[this.graphStyle],this.$graph,{mini:!0}],["handle",hs,this.$graph,{cb:this.onHandleMove}],["switchers",os,this.$switchers,{onClick:this.onSwitcherChange,onLongTap:this.onSwitcherChange,onEnter:this.onSwitcherEnter,onLeave:this.onSwitcherLeave}]].forEach(l=>{const d={animator:this.animator,$canvas:this.composer.$canvas,ctx:this.composer.ctx,graphStyle:this.graphStyle,chart:this,pairY:this.pairY,state:this.state,data:this.data,$parent:l[2],settings:s,additional:l[3]||{}};this[l[0]]=new l[1](d),this[l[0]].id=l[0]})}toggleSlave(t,s,i,a){const e=[];if(this.updateSpeed(a),this.state.zoomModeSlave===t)return;if(this.state.zoomSpecialOrigin=s,t){this.state.zoomModeSlave=!0,this.switchers.switchers.forEach((y,g)=>{y.classList.add("tchart--switcher__visible"),y.getElementsByTagName("span")[0].textContent=i.names[g]}),this.tip.labels.forEach((y,g)=>{y.$label.textContent=i.names[g]}),this.data.x=i.x;const n=[];for(let y=0;y<i.y.length;y++){this.data.ys[y].y=i.y[y];const g=i.hidden.indexOf(this.data.ys[y].id)===-1;this.state[`e_${y}`]=g,this.state[`o_${y}`]=g?1:0,this.state[`om_${y}`]=g?1:0,n[y]=g}this.switchers.render(n);const l=this.data.x[0],d=this.data.x[this.data.x.length-1];this.data.dates=[],this.data.datesShort=[],this.data.datesRange=[];const p=dt("xTooltipFormatter",this.data,1),o=dt("xTickFormatter",this.data,1),m=dt("xRangeFormatter",this.data,1);let r=0;for(let y=0;y<this.data.x.length;y++)this.data.dates[y]=p(this.data.x[y],!0),this.data.datesShort[y]=o(this.data.x[y],!0),this.data.datesRange[y]=m(this.data.x[y],!0),this.data.datesShort[y].length>r&&(r=this.data.datesShort[y].length);this.data.maxXTickLength=r,this.data.subchart=i.subchart,this.data.hidden=i.hidden;const c=this.getDefaultZoom({x1:l,x2:d,xg1:l,xg2:d,default:this.data.subchart.defaultZoom});this.state.x1=c.x1,this.state.x2=c.x2,this.state.xCount=this.data.x.length,this.state.xg1=l,this.state.xg2=d,this.state.xg1Ind=0,this.state.xg2Ind=this.data.x.length-1,this.state.xMainMin=l,this.state.xMainMax=d,this.state.xgMin=l,this.state.xgMax=d;const u=this.reduceGlobalRange({});u.isReduced&&(this.state.x1=u.x1,this.state.x2=u.x2,this.state.xg1=u.xg1,this.state.xg2=u.xg2,this.state.xg1Ind=u.xg1Ind,this.state.xg2Ind=u.xg2Ind);const M=this.getYMinMax(this.state.x1,this.state.x2,!1,!0),w=this.getYMinMax(l,d,!0);this.state.y1=M.min,this.state.y2=M.max,this.state.y1m=w.min,this.state.y2m=w.max}else this.switchers.switchers.forEach(n=>{n.classList.remove("tchart--switcher__visible")});const h=450;setTimeout(()=>{t||(this.state.zoomModeSlave=!1)},h+20),this.state.slaveVisibility=t?0:1,e.push({prop:"slaveVisibility",state:this.state,end:t?1:0,duration:h,group:{top:!0,bottom:!0}}),this.animator.add(e)}toggleZoomSpecial(t,s,i){var a=[];if(this.state.zoomModeSpecial!==t){var e=this.updateSpeed();if(t){var h=(this.state.x2-this.state.x1)/(this.state.dims.graph.w-this.settings.PADD[3]-this.settings.PADD[1]),n=this.settings.PADD[3]*h,l=this.settings.PADD[1]*h;this.state.zoomSpecialOrigin=(s-this.state.x1+n)/(this.state.x2-this.state.x1+n+l),this.state.zoomModeSpecial=!0,this.$h1.classList.add("tchart--header__hidden"),this.$zoom.classList.add("tchart--zoom__visible"),this.switchers.switchers.forEach(p=>{p.classList.remove("tchart--switcher__visible")}),this.slaveChart.toggleSlave(!0,this.state.zoomSpecialOrigin,i,e)}else this.$h1.classList.remove("tchart--header__hidden"),this.$zoom.classList.remove("tchart--zoom__visible"),this.switchers.switchers.forEach(p=>{p.classList.add("tchart--switcher__visible")}),this.slaveChart.toggleSlave(!1,this.state.zoomSpecialOrigin,null,e);var d=450;document.body.style.pointerEvents="none",setTimeout(()=>{t||(this.state.zoomModeSpecial=!1),document.body.style.pointerEvents=""},d+20),this.state.masterVisibility=t?1:0,a.push({prop:"masterVisibility",state:this.state,end:t?0:1,duration:d,group:{top:!0,bottom:!0}}),this.animator.add(a)}}insertDetails(t,s,i){const a=Math.ceil(J(this.data.x,t));let e=Math.ceil(J(this.data.x,s));const h=0,n=i.x.length-1;s>this.data.x[e]&&e++;const l=0,d=a,p=e-(this.graphStyle==="bar"||this.graphStyle==="step"?1:0),o=this.data.x.length-1,m=[],r=[],c=[],u=[];let M,w,y,g,f;const T=[],R=[];for(let x=l;x<d;x++)M=x-l,m[M]=this.data.x[x],r[M]=this.data.dates[x],c[M]=this.data.datesShort[x],u[M]=this.data.datesRange[x];for(let x=0;x<this.data.ys.length;x++){T[x]=T[x]||[],w=T[x],g=this.data.ys[x].y;for(let A=l;A<d;A++)w[A-l]=g[A]}const $=[],D=[],S=[],L=dt("xTooltipFormatter",this.data,1),_=dt("xTickFormatter",this.data,1),b=dt("xRangeFormatter",this.data,1);let I=0;for(let x=h;x<=n;x++){M=x-h+d,m[M]=i.x[x],r[M]=L(m[M],!0),c[M]=_(m[M],!0),u[M]=b(m[M],!0),c[M].length>I&&(I=c[M].length);const A=J(this.data.x,m[M]);$[x]=A,D[x]=Math.floor(A),S[x]=Math.ceil(A)}this.data.details.maxXTickLength=I;for(let x=0;x<this.data.ys.length;x++){T[x]=T[x]||[],w=T[x],g=this.data.ys[x].y,f=i.y[x],R[x]=R[x]||[],y=R[x];for(let A=h;A<=n;A++){let Y;this.graphStyle==="bar"?Y=g[D[A]]||0:this.graphStyle==="step"?Y=g[D[A]]:Y=g[D[A]]+($[A]-D[A])*(g[S[A]]-g[D[A]]);const q=f[A];this.graphStyle!=="bar"&&isNaN(Y)&&!isNaN(q)&&(Y=0),w[A-h+d]=q,y[A-h+d]=Y}}for(let x=p+1;x<=o;x++)M=x-p+n+d,m[M]=this.data.x[x],r[M]=this.data.dates[x],c[M]=this.data.datesShort[x],u[M]=this.data.datesRange[x];for(let x=0;x<this.data.ys.length;x++){T[x]=T[x]||[],w=T[x],g=this.data.ys[x].y;for(let A=p+1;A<=o;A++)w[A-p+n+d]=g[A]}this.state.detailInd1=d,this.state.detailInd2=d+n-h,this.data.x=m,this.data.dates=r,this.data.datesShort=c,this.data.datesRange=u;for(let x=0;x<this.data.ys.length;x++)this.data.ys[x].y=T[x],this.data.ys[x].yFrom=R[x]}revertDetails(){this.data.x=this.data.saved.x,this.data.dates=this.data.saved.dates,this.data.datesShort=this.data.saved.datesShort,this.data.datesRange=this.data.saved.datesRange;for(let t=0;t<this.data.ys.length;++t)this.data.ys[t].y=this.data.saved.y[t]}}export{wt as default};
