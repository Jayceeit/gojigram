const __vite__fileDeps=["assets/pageIm-B4GzUrmM-D9QjBKom.js","assets/index-p16BOqnp.js","assets/index-B8jL9cEs.css","assets/page-VE9OcG0U-aQMl6CMd.js","assets/pageAuthCode-BYy_YHRR-CJe_iUCX.js","assets/codeInputField-DJ7B9Vyw-g-D0bfJF.js","assets/wrapEmojiText-DJXpRYaz-DsSuZO2C.js","assets/button-BD6I5F21-BCIxP22E.js","assets/putPreloader-BTYVD0HY-Cj27QpTZ.js","assets/scrollable-DoUmbSw--CLoL6L-W.js","assets/pageSignQR-DljwMMf8-Cr_aBgz1.js","assets/textToSvgURL-Cnw_Q8Rw-CS9KuXZv.js","assets/countryInputField-Dd2coeyi-CrWpF_Pz.js"],__vite__mapDeps=i=>i.map(i=>__vite__fileDeps[i]);
import{S as r,X as k,a as w,G as _,x as E,V as x,_ as j,v as D,g as A,z as P,U as V,B}from"./index-p16BOqnp.js";import{i as C}from"./putPreloader-BTYVD0HY-Cj27QpTZ.js";import{z as N,_ as U}from"./page-VE9OcG0U-aQMl6CMd.js";import{n as $,i as F,a as G}from"./countryInputField-Dd2coeyi-CrWpF_Pz.js";import{H as T,z as O}from"./button-BD6I5F21-BCIxP22E.js";import{_ as Y,p as H,z as Q,M as y}from"./wrapEmojiText-DJXpRYaz-DsSuZO2C.js";import{p as X,g as J}from"./pageSignQR-DljwMMf8-Cr_aBgz1.js";import"./scrollable-DoUmbSw--CLoL6L-W.js";import"./textToSvgURL-Cnw_Q8Rw-CS9KuXZv.js";const K=["./pageIm-B4GzUrmM.js","./index-Bk6w0QSK.js","./index-jdz_mo9Z.css","./page-VE9OcG0U.js","./pageAuthCode-BYy_YHRR.js","./codeInputField-DJ7B9Vyw.js","./wrapEmojiText-DJXpRYaz.js","./button-BD6I5F21.js","./putPreloader-BTYVD0HY.js","./countryInputField-Dd2coeyi.js","./scrollable-DoUmbSw-.js","./pageSignQR-DljwMMf8.js","./textToSvgURL-Cnw_Q8Rw.js"],I=c=>c.map(p=>K[p]);let a=null,l;const W=()=>{const c=document.createElement("div");c.classList.add("input-wrapper");let p,L;const u=new $({onCountryChange:(e,t)=>{p=e,L=t,t&&(s.value=s.lastValue="+"+t.country_code,setTimeout(()=>{m.focus(),Y(m,!0)},0))}}),s=new F({onInput:e=>{H.loadLottieWorkers();const{country:t,code:i}=e||{},n=t?t.name||t.default_name:"";n!==u.value&&(!p||!t||!i||p!==t&&L.country_code!==i.country_code)&&u.override(t,i,n),t||s.value.length-1>1?a.style.visibility="":a.style.visibility="hidden"}}),m=s.input;m.addEventListener("keypress",e=>{if(!a.style.visibility&&e.key==="Enter")return S()});const d=new G({text:"Login.KeepSigned",name:"keepSession",withRipple:!0,checked:!0});d.input.addEventListener("change",()=>{const e=d.checked;r.managers.appStateManager.pushToState("keepSigned",e),k.toggleStorages(e,!0)}),k.getState().then(e=>{w.isAvailable()?d.checked=e.keepSigned:(d.checked=!1,d.label.classList.add("checkbox-disabled"))}),a=T("btn-primary btn-color-primary",{text:"Login.Next"}),a.style.visibility="hidden";const S=e=>{e&&P(e);const t=Q([a,l],!0);y(a,_("PleaseWait")),C(a);const i=s.value;r.managers.apiManager.invokeApi("auth.sendCode",{phone_number:i,api_id:E.id,api_hash:E.hash,settings:{_:"codeSettings",pFlags:{}}}).then(async n=>{if(n._==="auth.sentCodeSuccess"){const{authorization:o}=n;o._==="auth.authorization"&&(await r.managers.apiManager.setUser(o.user),x(()=>j(()=>import("./pageIm-B4GzUrmM-D9QjBKom.js"),__vite__mapDeps([0,1,2,3])),I([0,1,2,3]),import.meta.url).then(h=>{h.default.mount()}))}x(()=>j(()=>import("./pageAuthCode-BYy_YHRR-CJe_iUCX.js"),__vite__mapDeps([4,1,2,3,5,6,7,8,9,10,11,12])),I([4,1,2,3,5,6,7,8,9,10,11,12]),import.meta.url).then(o=>o.default.mount(Object.assign(n,{phone_number:i})))}).catch(n=>{switch(t(),n.type){case"PHONE_NUMBER_INVALID":s.setError(),y(s.label,_("Login.PhoneLabelInvalid")),m.classList.add("error"),y(a,_("Login.Next"));break;default:console.error("auth.sendCode error:",n),a.innerText=n.type;break}})};U(a,S),l=T("btn-primary btn-secondary btn-primary-transparent primary",{text:"Login.QR.Login"}),l.addEventListener("click",()=>{X.mount()}),c.append(u.container,s.container,d.label,a,l);const v=document.createElement("h4");v.classList.add("text-center"),D(v,"Login.Title");const b=document.createElement("div");b.classList.add("subtitle","text-center"),D(b,"Login.StartText"),q.pageEl.querySelector(".container").append(v,b,c);const M=()=>{r.managers.apiManager.invokeApi("help.getNearestDc").then(e=>{var h;const t=w.getFromCache("langPack");t&&!((h=t.countries)!=null&&h.hash)&&V.getLangPack(t.lang_code).then(()=>{s.simulateInputEvent()});const i=new Set([1,2,3,4,5]),n=[e.this_dc];let o;return e.nearest_dc!==e.this_dc&&(o=r.managers.apiManager.getNetworkerVoid(e.nearest_dc).then(()=>{n.push(e.nearest_dc)})),(o||Promise.resolve()).then(()=>{n.forEach(g=>{i.delete(g)});const z=[...i],f=async()=>{const g=z.shift();if(!g)return;const R=`dc${g}_auth_key`;if(await B.get(R))return f();setTimeout(()=>{r.managers.apiManager.getNetworkerVoid(g).finally(f)},3e3)};f()}),e}).then(e=>{!u.value.length&&!s.value.length&&u.selectCountryByIso2(e.country)})};A||setTimeout(()=>{m.focus()},0),J(c),M()},q=new N("page-sign",!0,W,()=>{a&&(y(a,_("Login.Next")),O(a,void 0,void 0,!0),a.removeAttribute("disabled")),l&&l.removeAttribute("disabled"),r.managers.appStateManager.pushToState("authState",{_:"authStateSignIn"})});export{q as default};
